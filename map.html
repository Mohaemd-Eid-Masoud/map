<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <title>ZenZone Map</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- Cairo Font -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Cairo', sans-serif;
            margin: 0;
            padding: 0;
            background: #ffffff;
            direction: rtl;
            text-align: right;
        }
        
        header {
            background: linear-gradient(135deg, #5baa91 0%, rgba(102, 161, 133, 1) 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        header h1 {
            margin: 0;
            font-size: 2.5rem;
            font-weight: 700;
        }
        
        .header-subtitle {
            margin-top: 5px;
            font-size: 1rem;
            opacity: 0.9;
        }
        
        #map {
            height: calc(100vh - 100px);
            width: 100%;
        }
        
        .location-button {
            position: fixed;
            top: 120px;
            left: 30px;
            background: linear-gradient(135deg, #5baa91 0%, rgba(102, 161, 133, 1) 100%);
            color: white;
            border: none;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            font-size: 1.5rem;
            z-index: 1000;
        }
        
        .location-button:hover {
            transform: scale(1.1);
        }
        
        /* Collapsible Quick Stats Panel */
        .stats-card {
            position: fixed;
            top: 100px;
            right: 15px;
            width: 380px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.12);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            transform: translateX(0);
            max-height: calc(100vh - 140px);
            overflow: hidden;
        }
        
        .stats-card.collapsed {
            transform: translateX(100%);
        }
        
        .stats-card.expanded {
            transform: translateX(0);
        }
        
        /* Toggle Button */
        .stats-toggle {
            position: fixed;
            top: 120px;
            right: 15px;
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #5baa91 0%, #4a8c7a 100%);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            z-index: 1001;
            box-shadow: 0 4px 15px rgba(91, 170, 145, 0.3);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .stats-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(91, 170, 145, 0.4);
        }
        
        .stats-toggle.collapsed {
            right: 15px;
        }
        
        .stats-toggle.expanded {
            right: 395px;
        }
        
        /* Panel Header */
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 20px 15px 20px;
            border-bottom: 2px solid #f0f0f0;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 16px 16px 0 0;
        }
        
        .panel-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #333;
            margin: 0;
        }
        
        .panel-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .panel-close:hover {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
            color: white;
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
        }
        
        .panel-close:active {
            transform: scale(0.95);
        }
        
        .panel-close::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: all 0.3s ease;
        }
        
        .panel-close:hover::before {
            width: 100%;
            height: 100%;
        }
        
        .panel-close:focus {
            outline: 2px solid #ff6b6b;
            outline-offset: 2px;
        }
        
        /* Panel Content */
        .panel-content {
            padding: 20px;
            max-height: calc(100vh - 200px);
            overflow-y: auto;
            scroll-behavior: smooth;
        }
        
        .panel-content::-webkit-scrollbar {
            width: 6px;
        }
        
        .panel-content::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        .panel-content::-webkit-scrollbar-thumb {
            background: #5baa91;
            border-radius: 10px;
        }
        
        .panel-content::-webkit-scrollbar-thumb:hover {
            background: #4a8c7a;
        }
        
        /* Component Sections */
        .component-section {
            margin-bottom: 24px;
            padding: 16px;
            background: #f8f9fa;
            border-radius: 12px;
            border-left: 4px solid #5baa91;
        }
        
        .component-section:last-child {
            margin-bottom: 0;
        }
        
        .section-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 16px;
            font-weight: 600;
            color: #333;
            font-size: 1.1rem;
        }
        
        .section-icon {
            font-size: 1.2rem;
        }
        
        /* Quick Actions Component */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }
        
        .quick-action-btn {
            padding: 12px 8px;
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            color: #495057;
            font-family: 'Cairo', sans-serif;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            min-height: 44px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }
        
        .quick-action-btn:hover {
            background: #e9ecef;
            border-color: #5baa91;
            color: #5baa91;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(91, 170, 145, 0.2);
        }
        
        .quick-action-btn:active {
            transform: scale(0.98);
        }
        
        .quick-action-icon {
            font-size: 1.2rem;
        }
        
        .quick-action-label {
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        /* Search Component - Enhanced Styling */
        .search-container {
            position: relative;
            margin-bottom: 8px;
        }
        
        .search-input {
            width: 100%;
            padding: 16px 50px 16px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            font-family: 'Cairo', sans-serif;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s ease;
            background: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            min-height: 52px;
            direction: rtl;
            text-align: right;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #5baa91;
            box-shadow: 0 0 0 3px rgba(91, 170, 145, 0.1), 0 4px 12px rgba(0,0,0,0.1);
            transform: translateY(-1px);
        }
        
        .search-input::placeholder {
            color: #999;
            font-weight: 400;
        }
        
        .search-input:hover {
            border-color: #5baa91;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        
        .search-icon {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: #5baa91;
            font-size: 1.2rem;
            pointer-events: none;
            transition: all 0.3s ease;
        }
        
        .search-input:focus + .search-icon {
            color: #4a8c7a;
            transform: translateY(-50%) scale(1.1);
        }
        
        /* Route Options Component */
        .route-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }
        
        .route-btn {
            padding: 12px 8px;
            border: 2px solid #e1e5e9;
            background: white;
            color: #6c757d;
            border-radius: 10px;
            cursor: pointer;
            font-family: 'Cairo', sans-serif;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
            text-align: center;
            min-height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        
        .route-btn:hover {
            border-color: #5baa91;
            color: #5baa91;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(91, 170, 145, 0.2);
        }
        
        .route-btn.active {
            background: linear-gradient(135deg, #5baa91 0%, #4a8c7a 100%);
            border-color: #5baa91;
            color: white;
            box-shadow: 0 4px 12px rgba(91, 170, 145, 0.3);
        }
        
        /* Workspaces List Component - Enhanced Workspace List */
        .workspaces-list {
            max-height: 200px;
            overflow-y: auto;
            padding: 8px;
            scroll-behavior: smooth;
            background: #f8f9fa;
            border-radius: 12px;
            margin-top: 8px;
        }
        
        .workspaces-list::-webkit-scrollbar {
            width: 6px;
        }
        
        .workspaces-list::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        .workspaces-list::-webkit-scrollbar-thumb {
            background: #5baa91;
            border-radius: 10px;
        }
        
        .workspaces-list::-webkit-scrollbar-thumb:hover {
            background: #4a8c7a;
        }
        
        .workspace-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            margin-bottom: 8px;
            background: white;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
            font-size: 0.95rem;
            min-height: 70px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
        }
        
        .workspace-item:hover {
            background: #f8f9fa;
            border-left-color: #5baa91;
            transform: translateX(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .workspace-item.selected {
            background: linear-gradient(135deg, #5baa91 0%, #4a8c7a 100%);
            color: white;
            border-left-color: #3a7a6a;
            box-shadow: 0 4px 12px rgba(91, 170, 145, 0.3);
        }
        
        .workspace-name {
            font-weight: 600;
            font-size: 0.95rem;
            color: #333;
            margin: 0;
        }
        
        .workspace-badge {
            background: #5baa91;
            color: white;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: 700;
            white-space: nowrap;
        }
        
        .workspace-item.selected .workspace-badge {
            background: white;
            color: #5baa91;
        }
        
        /* Status Component */
        .status-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }
        
        .status-item {
            padding: 12px 16px;
            background: white;
            border-radius: 10px;
            border-left: 4px solid #5baa91;
            min-height: 50px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .status-label {
            font-size: 0.85rem;
            color: #666;
            font-weight: 500;
            margin-bottom: 4px;
        }
        
        .status-value {
            font-weight: 700;
            color: #5baa91;
            font-size: 1rem;
        }
        
        /* Nearest Workspace Component */
        .nearest-workspace {
            background: linear-gradient(135deg, #5baa91 0%, #4a8c7a 100%);
            color: white;
            padding: 16px 18px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 16px rgba(91, 170, 145, 0.3);
        }
        
        .nearest-workspace:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(91, 170, 145, 0.4);
        }
        
        .nearest-title {
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 6px;
            opacity: 0.9;
        }
        
        .nearest-name {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 4px;
        }
        
        .nearest-distance {
            font-size: 0.9rem;
            opacity: 0.9;
            font-weight: 600;
        }
        
        .direction-panel {
            position: fixed;
            bottom: 30px;
            left: 30px;
            background: rgba(255, 255, 255, 0.98);
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 12px 40px rgba(0,0,0,0.15);
            z-index: 1000;
            min-width: 320px;
            max-width: 380px;
            display: none;
            transform: translateY(100%);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #5baa91;
        }
        
        .direction-panel.show {
            display: block;
            transform: translateY(0);
            animation: slideInUp 0.4s ease-out;
        }
        
        .direction-panel.collapsed {
            transform: translateY(100%);
        }
        
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(100%) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .direction-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
            position: relative;
        }
        
        .direction-header::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 60px;
            height: 2px;
            background: linear-gradient(135deg, #5baa91 0%, #4a8c7a 100%);
            border-radius: 1px;
        }
        
        .direction-title {
            font-weight: 700;
            color: #333;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 0;
        }
        
        .direction-title::before {
            content: 'ðŸ§­';
            font-size: 1.4rem;
            animation: compassSpin 3s linear infinite;
        }
        
        @keyframes compassSpin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .direction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding: 12px 16px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            border-left: 4px solid #5baa91;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .direction-item:hover {
            background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(91, 170, 145, 0.15);
        }
        
        .direction-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(91, 170, 145, 0.1), transparent);
            transition: left 0.5s ease;
        }
        
        .direction-item:hover::before {
            left: 100%;
        }
        
        .direction-label {
            color: #555;
            font-size: 0.95rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .direction-value {
            font-weight: 700;
            color: #5baa91;
            font-size: 1rem;
            background: white;
            padding: 6px 12px;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            border: 1px solid rgba(91, 170, 145, 0.2);
            transition: all 0.3s ease;
        }
        
        .direction-value:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(91, 170, 145, 0.2);
        }
        
        .action-button {
            display: inline-block;
            width: 100%;
            padding: 15px 20px;
            background: linear-gradient(135deg, #5baa91 0%, rgba(102, 161, 133, 1) 100%);
            color: white;
            border-radius: 12px;
            text-decoration: none;
            font-weight: 700;
            text-align: center;
            border: none;
            cursor: pointer;
            font-family: 'Cairo', sans-serif;
            margin-top: 15px;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            box-shadow: 0 6px 20px rgba(91, 170, 145, 0.3);
        }
        
        .action-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s ease;
        }
        
        .action-button:hover {
            transform: translateY(-3px);
            color: white;
            text-decoration: none;
            box-shadow: 0 8px 25px rgba(91, 170, 145, 0.4);
        }
        
        .action-button:hover::before {
            left: 100%;
        }
        
        .action-button:active {
            transform: translateY(-1px);
        }
        
        /* Enhanced close button for direction panel */
        .direction-panel .close-btn {
            background-color: white !important;
            border: none !important;
            font-size: 1.5rem !important;
            cursor: pointer !important;
            color: #666 !important;
            width: 32px !important;
            height: 32px !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            border-radius: 50% !important;
            transition: all 0.3s ease !important;
            position: relative !important;
            overflow: hidden !important;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1) !important;
        }
        
        .direction-panel .close-btn:hover {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%) !important;
            color: white !important;
            transform: scale(1.1) !important;
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3) !important;
        }
        
        .direction-panel .close-btn:active {
            transform: scale(0.95) !important;
        }
        
        .direction-panel .close-btn::before {
            content: '' !important;
            position: absolute !important;
            top: 50% !important;
            left: 50% !important;
            width: 0 !important;
            height: 0 !important;
            background: rgba(255, 255, 255, 0.2) !important;
            border-radius: 50% !important;
            transform: translate(-50%, -50%) !important;
            transition: all 0.3s ease !important;
        }
        
        .direction-panel .close-btn:hover::before {
            width: 100% !important;
            height: 100% !important;
        }
        
        .direction-panel .close-btn:focus {
            outline: 2px solid #ff6b6b !important;
            outline-offset: 2px !important;
        }
        
        /* Hide attribution */
        .leaflet-control-attribution {
            display: none !important;
        }
        
        @media (max-width: 768px) {
            header h1 {
                font-size: 1.8rem;
            }
            
            .header-subtitle {
                font-size: 0.9rem;
            }
            
            .stats-card {
                position: fixed;
                top: 90px;
                left: 10px;
                right: 10px;
                width: auto;
                margin: 0;
                padding: 16px;
                min-width: auto;
                z-index: 1000;
                max-height: 65vh;
                border-radius: 20px;
            }
            
            .stats-toggle {
                top: 100px;
                left: 10px;
                width: 45px;
                height: 45px;
                font-size: 1.3rem;
            }
            
            .stats-toggle.expanded {
                left: calc(100vw - 55px);
            }
            
            .direction-panel {
                position: fixed;
                bottom: 20px;
                left: 15px;
                right: 15px;
                width: auto;
                margin: 0;
                padding: 15px;
                min-width: auto;
                max-width: none;
                z-index: 1000;
                border-radius: 20px;
            }
            
            .direction-title {
                font-size: 1.1rem;
            }
            
            .close-btn {
                width: 40px;
                height: 40px;
                font-size: 1.3rem;
            }
            
            .direction-item {
                padding: 12px 0;
                margin-bottom: 10px;
            }
            
            .direction-label {
                font-size: 0.95rem;
            }
            
            .direction-value {
                font-size: 1rem;
            }
            
            .action-button {
                padding: 15px 20px;
                font-size: 1rem;
                min-height: 48px;
                border-radius: 12px;
            }
            
            .location-button {
                top: auto;
                bottom: 100px;
                right: 20px;
                width: 55px;
                height: 55px;
                font-size: 1.3rem;
            }
            
            .fab {
                bottom: 20px;
                right: 20px;
                width: 55px;
                height: 55px;
                font-size: 20px;
            }
            
            .fab-menu {
                bottom: 85px;
                right: 20px;
                gap: 12px;
            }
            
            .fab-item {
                width: 45px;
                height: 45px;
                font-size: 16px;
            }
            
            .toast {
                right: 10px;
                left: 10px;
                max-width: none;
                font-size: 0.9rem;
                padding: 12px 16px;
            }
            
            .tracking-panel {
                width: calc(100vw - 30px);
                left: 15px;
                right: 15px;
                top: 15px;
            }
            
            #map {
                height: calc(100vh - 120px);
            }
            
            /* Improve touch targets */
            .action-button {
                padding: 15px 20px;
                font-size: 1rem;
                min-height: 48px;
            }
            
            .track-btn {
                padding: 15px 16px;
                font-size: 1rem;
                min-height: 48px;
            }
            
            .close-btn {
                width: 35px;
                height: 35px;
                font-size: 1.3rem;
            }
        }
        
        /* Floating Action Button */
        .fab {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #5baa91, #4a8c7a);
            border-radius: 50%;
            box-shadow: 0 8px 25px rgba(91, 170, 145, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
            border: none;
            color: white;
            font-size: 24px;
        }
        
        .fab.over-stats {
            bottom: auto;
            top: 120px;
            right: 30px;
            z-index: 1002;
        }
        
        .fab:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 12px 35px rgba(91, 170, 145, 0.6);
        }
        
        .fab:active {
            transform: translateY(-1px) scale(0.98);
        }
        
        /* FAB Menu */
        .fab-menu {
            position: fixed;
            bottom: 100px;
            right: 30px;
            display: none;
            flex-direction: column;
            gap: 15px;
            z-index: 999;
        }
        
        .fab-menu.over-stats {
            bottom: auto;
            top: 190px;
            right: 30px;
            z-index: 1001;
        }
        
        .fab-menu.active {
            display: flex;
            animation: slideInUp 0.3s ease-out;
        }
        
        .fab-item {
            width: 50px;
            height: 50px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            color: #5baa91;
            font-size: 18px;
        }
        
        .fab-item:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
        }
        
        /* Progress Bar */
        .progress-bar {
            position: fixed;
            top: 0;
            left: 0;
            width: 0%;
            height: 3px;
            background: linear-gradient(90deg, #5baa91, #4a8c7a);
            z-index: 1001;
            transition: width 0.3s ease;
        }
        
        /* Toast Notifications */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border-radius: 12px;
            padding: 16px 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            border-left: 4px solid #5baa91;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1002;
            max-width: 300px;
        }
        
        .toast.show {
            transform: translateX(0);
        }
        
        .toast.success {
            border-left-color: #4CAF50;
        }
        
        .toast.error {
            border-left-color: #F44336;
        }
        
        .toast.warning {
            border-left-color: #FF9800;
        }
        
        /* Loading Spinner */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #5baa91;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Pulse Animation */
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(91, 170, 145, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(91, 170, 145, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(91, 170, 145, 0);
            }
        }
        
        /* Hover Effects */
        .workspace-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
        }
        
        .direction-item:hover {
            background: rgba(91, 170, 145, 0.05);
            border-radius: 8px;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .fab {
                bottom: 20px;
                right: 20px;
                width: 55px;
                height: 55px;
            }
            
            .fab.over-stats {
                bottom: auto;
                top: 110px;
                right: 20px;
                width: 50px;
                height: 50px;
                z-index: 1002;
            }
            
            .fab-menu {
                bottom: 85px;
                right: 20px;
            }
            
            .fab-menu.over-stats {
                bottom: auto;
                top: 170px;
                right: 20px;
                z-index: 1001;
            }
            
            .toast {
                right: 10px;
                left: 10px;
                max-width: none;
            }
        }
        
        /* Real-time Tracking Panel */
        .tracking-panel {
            position: fixed;
            top: 20px;
            left: 20px;
            width: 350px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            transform: translateX(-400px);
            transition: transform 0.3s ease;
            font-family: 'Cairo', sans-serif;
        }
        
        .tracking-panel.show {
            transform: translateX(0);
        }
        
        .tracking-content {
            padding: 20px;
        }
        
        .tracking-status {
            margin-bottom: 20px;
            padding: 15px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            border-left: 4px solid #5baa91;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #5baa91;
            animation: pulse 2s infinite;
        }
        
        .status-dot.tracking {
            background: #28a745;
            animation: pulse 1s infinite;
        }
        
        .status-dot.paused {
            background: #ffc107;
            animation: none;
        }
        
        .status-dot.error {
            background: #dc3545;
            animation: none;
        }
        
        .tracking-info {
            margin-bottom: 20px;
        }
        
        .info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .info-item:last-child {
            border-bottom: none;
        }
        
        .info-label {
            font-weight: 600;
            color: #666;
            font-size: 0.9rem;
        }
        
        .info-value {
            font-weight: 700;
            color: #5baa91;
            font-size: 1rem;
        }
        
        .navigation-instructions {
            margin-bottom: 20px;
        }
        
        .navigation-instructions h4 {
            margin: 0 0 15px 0;
            color: #333;
            font-size: 1.1rem;
        }
        
        .instruction-card {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: linear-gradient(135deg, #5baa91 0%, #4a8c7a 100%);
            color: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(91, 170, 145, 0.3);
        }
        
        .instruction-icon {
            font-size: 2rem;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .instruction-text {
            font-weight: 600;
            font-size: 1rem;
            line-height: 1.4;
        }
        
        .tracking-controls {
            display: flex;
            gap: 10px;
        }
        
        .track-btn {
            flex: 1;
            padding: 12px 16px;
            background: linear-gradient(135deg, #5baa91 0%, #4a8c7a 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-family: 'Cairo', sans-serif;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }
        
        .track-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(91, 170, 145, 0.4);
        }
        
        .track-btn.secondary {
            background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);
        }
        
        .track-btn.secondary:hover {
            box-shadow: 0 6px 20px rgba(108, 117, 125, 0.4);
        }
        
        /* Tracking Path */
        .tracking-path {
            stroke: #dc3545;
            stroke-width: 4;
            stroke-linecap: round;
            stroke-linejoin: round;
            fill: none;
            opacity: 0.8;
        }
        
        /* Real-time Location Marker */
        .realtime-marker {
            background: #dc3545;
            border: 3px solid white;
            box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.3);
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .tracking-panel {
                width: calc(100vw - 40px);
                left: 20px;
                right: 20px;
            }
        }
        
        .nearest-workspace {
            background: linear-gradient(135deg, #5baa91 0%, #4a8c7a 100%);
            color: white;
            padding: 18px 20px;
            border-radius: 16px;
            margin-bottom: 20px;
            box-shadow: 0 8px 24px rgba(91, 170, 145, 0.3);
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .nearest-workspace:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 32px rgba(91, 170, 145, 0.4);
        }
        
        .nearest-title {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 8px;
            opacity: 0.9;
        }
        
        .nearest-name {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 6px;
        }
        
        .nearest-distance {
            font-size: 0.95rem;
            opacity: 0.9;
            font-weight: 600;
        }
        
        /* Enhanced Quick Stats Panel Improvements */
        
        /* Smooth scrolling for workspace list */
        .workspaces-list {
            scroll-behavior: smooth;
        }
        
        /* Better focus states for accessibility */
        .search-input:focus,
        .route-btn:focus,
        .workspace-item:focus {
            outline: 2px solid #5baa91;
            outline-offset: 2px;
        }
        #searchInput{
        max-width: 15rem;
        }
        /* Loading state for search */
        .search-input.loading {
            background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="%235baa91" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12a9 9 0 11-6.219-8.56"/></svg>');
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 20px;
            padding-right: 50px;
        }
        
        /* Empty state for workspace list */
        .workspaces-list:empty::after {
            content: "No workspaces found";
            display: block;
            text-align: center;
            padding: 40px 20px;
            color: #666;
            font-style: italic;
            background: #f8f9fa;
            border-radius: 12px;
            margin: 10px 0;
        }
        
        /* Better visual hierarchy */
        .stats-section {
            margin-bottom: 24px;
        }
        
        .stats-section:last-child {
            margin-bottom: 0;
        }
        
        .section-title {
            font-size: 1rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e9ecef;
        }
        
        /* Enhanced workspace item states */
        .workspace-item:active {
            transform: scale(0.98);
        }
        
        .workspace-item.loading {
            opacity: 0.7;
            pointer-events: none;
        }
        
        .workspace-item.loading::after {
            content: "";
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            width: 16px;
            height: 16px;
            border: 2px solid #5baa91;
            border-top: 2px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        .workspaces-list {
            max-height: 100px;
        }
        /* Status indicators */
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .status-indicator.ready {
            background: #d4edda;
            color: #155724;
        }
        
        .status-indicator.locating {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-indicator.error {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status-indicator.success {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        /* Quick actions */
        .quick-actions {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }
        
        .quick-action-btn {
            flex: 1;
            padding: 12px 8px;
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            color: #495057;
            font-family: 'Cairo', sans-serif;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            min-height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        
        .quick-action-btn:hover {
            background: #e9ecef;
            border-color: #5baa91;
            color: #5baa91;
            transform: translateY(-1px);
        }
        
        .quick-action-btn:active {
            transform: scale(0.98);
        }
        
        /* Responsive improvements for very small screens */
        @media (max-width: 480px) {
            .stats-card {
                top: 80px;
                left: 8px;
                right: 8px;
                padding: 12px;
                max-height: 60vh;
            }
            
            .stats-title {
                font-size: 1.1rem;
                margin-bottom: 12px;
            }
            
            .search-input {
                padding: 14px 40px 14px 14px;
                font-size: 0.95rem;
                min-height: 48px;
            }
            
            .route-options {
                gap: 8px;
                margin-bottom: 12px;
            }
            
            .route-btn {
                padding: 12px 6px;
                font-size: 0.85rem;
                min-height: 48px;
            }
            
            .workspaces-list {
                margin-bottom: 12px;
            }
            
            .workspace-item {
                padding: 12px 14px;
                margin-bottom: 4px;
                min-height: 52px;
                font-size: 0.9rem;
            }
            
            .quick-actions {
                flex-direction: column;
                gap: 6px;
            }
            
            .quick-action-btn {
                min-height: 40px;
                font-size: 0.85rem;
            }
        }
        
        /* High contrast mode support */
        @media (prefers-contrast: high) {
            .stats-card {
                border: 2px solid #333;
                background: white;
            }
            
            .workspace-item {
                border: 1px solid #ccc;
            }
            
            .workspace-item.selected {
                border: 2px solid #000;
            }
        }
        
        /* Reduced motion support */
        @media (prefers-reduced-motion: reduce) {
            .workspace-item,
            .route-btn,
            .search-input,
            .nearest-workspace {
                transition: none;
            }
            
            .workspace-item:hover {
                transform: none;
            }
        }
        
        /* Mobile Responsive Design */
        @media (max-width: 768px) {
            .stats-card {
                top: 90px;
                left: 10px;
                width: calc(100vw - 20px);
                max-width: 400px;
                max-height: 70vh;
            }
            
            .stats-toggle {
                top: 100px;
                left: 10px;
                width: 45px;
                height: 45px;
                font-size: 1.3rem;
            }
            
            .stats-toggle.expanded {
                left: calc(100vw - 55px);
            }
            
            .panel-header {
                padding: 16px 16px 12px 16px;
            }
            
            .panel-title {
                font-size: 1.2rem;
            }
            
            .panel-content {
                padding: 16px;
                max-height: calc(70vh - 80px);
            }
            
            .component-section {
                margin-bottom: 20px;
                padding: 14px;
            }
            
            .section-header {
                font-size: 1rem;
                margin-bottom: 12px;
            }
            
            .quick-actions {
                grid-template-columns: repeat(3, 1fr);
                gap: 6px;
            }
            
            .quick-action-btn {
                padding: 10px 6px;
                min-height: 40px;
                font-size: 0.85rem;
            }
            
            .quick-action-icon {
                font-size: 1.1rem;
            }
            
            .quick-action-label {
                font-size: 0.7rem;
            }
            
            .search-input {
                padding: 14px 40px 14px 14px;
                font-size: 0.95rem;
                min-height: 48px;
            }
            
            .search-icon {
                right: 14px;
                font-size: 1.1rem;
            }
            
            .route-options {
                gap: 6px;
            }
            
            .route-btn {
                padding: 10px 6px;
                font-size: 0.85rem;
                min-height: 44px;
            }
            
            .workspaces-list {
                max-height: 180px;
            }
            
            .workspace-item {
                padding: 10px 14px;
                margin-bottom: 4px;
                min-height: 52px;
                font-size: 0.9rem;
            }
            
            .workspace-name {
                font-size: 0.9rem;
            }
            
            .workspace-badge {
                padding: 3px 8px;
                font-size: 0.7rem;
            }
            
            .status-grid {
                gap: 8px;
            }
            
            .status-item {
                padding: 10px 14px;
                min-height: 46px;
            }
            
            .status-label {
                font-size: 0.8rem;
            }
            
            .status-value {
                font-size: 0.95rem;
            }
            
            .nearest-workspace {
                padding: 14px 16px;
                border-radius: 10px;
            }
            
            .nearest-title {
                font-size: 0.8rem;
            }
            
            .nearest-name {
                font-size: 1rem;
            }
            
            .nearest-distance {
                font-size: 0.85rem;
            }
        }
        
        /* Very Small Screens */
        @media (max-width: 480px) {
            .stats-card {
                top: 80px;
                left: 8px;
                width: calc(100vw - 16px);
                max-height: 65vh;
            }
            
            .stats-toggle {
                top: 90px;
                left: 8px;
                width: 40px;
                height: 40px;
                font-size: 1.2rem;
            }
            
            .stats-toggle.expanded {
                left: calc(100vw - 48px);
            }
            
            .panel-header {
                padding: 12px 12px 10px 12px;
            }
            
            .panel-title {
                font-size: 1.1rem;
            }
            
            .panel-content {
                padding: 12px;
                max-height: calc(65vh - 70px);
            }
            
            .component-section {
                margin-bottom: 16px;
                padding: 12px;
            }
            
            .section-header {
                font-size: 0.95rem;
                margin-bottom: 10px;
            }
            
            .quick-actions {
                gap: 4px;
            }
            
            .quick-action-btn {
                padding: 8px 4px;
                min-height: 36px;
                font-size: 0.8rem;
            }
            
            .quick-action-icon {
                font-size: 1rem;
            }
            
            .quick-action-label {
                font-size: 0.65rem;
            }
            
            .search-input {
                padding: 12px 35px 12px 12px;
                font-size: 0.9rem;
                min-height: 44px;
            }
            
            .search-icon {
                right: 12px;
                font-size: 1rem;
            }
            
            .route-options {
                gap: 4px;
            }
            
            .route-btn {
                padding: 8px 4px;
                font-size: 0.8rem;
                min-height: 40px;
            }
            
            .workspaces-list {
                max-height: 160px;
            }
            
            .workspace-item {
                padding: 8px 12px;
                margin-bottom: 3px;
                min-height: 48px;
                font-size: 0.85rem;
            }
            
            .workspace-name {
                font-size: 0.85rem;
            }
            
            .workspace-badge {
                padding: 2px 6px;
                font-size: 0.65rem;
            }
            
            .status-grid {
                gap: 6px;
            }
            
            .status-item {
                padding: 8px 12px;
                min-height: 42px;
            }
            
            .status-label {
                font-size: 0.75rem;
            }
            
            .status-value {
                font-size: 0.9rem;
            }
            
            .nearest-workspace {
                padding: 12px 14px;
            }
            
            .nearest-title {
                font-size: 0.75rem;
            }
            
            .nearest-name {
                font-size: 0.95rem;
            }
            
            .nearest-distance {
                font-size: 0.8rem;
            }
        }
        
        /* Help Tooltip System */
        .help-tooltip {
            position: fixed;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 0.9rem;
            z-index: 10000;
            pointer-events: none;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s ease;
            max-width: 250px;
            text-align: center;
            backdrop-filter: blur(10px);
        }
        
        .help-tooltip.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        .help-tooltip::after {
            content: '';
            position: absolute;
            top: -5px;
            left: 50%;
            transform: translateX(-50%);
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
            border-bottom: 5px solid rgba(0, 0, 0, 0.9);
        }
        
        /* Enhanced Visual Feedback */
        .pulse-highlight {
            animation: pulseHighlight 0.6s ease-in-out;
        }
        
        @keyframes pulseHighlight {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .shake {
            animation: shake 0.5s ease-in-out;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .loading-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        
        .loading-spinner-large {
            width: 60px;
            height: 60px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #5baa91;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        /* Welcome Tour */
        .welcome-tour {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10001;
            display: none;
            align-items: center;
            justify-content: center;
        }
        
        .welcome-tour.show {
            display: flex;
        }
        
        .tour-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        .tour-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #5baa91;
            margin-bottom: 15px;
        }
        
        .tour-text {
            color: #666;
            line-height: 1.6;
            margin-bottom: 20px;
        }
        
        .tour-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        
        .tour-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .tour-btn.primary {
            background: #5baa91;
            color: white;
        }
        
        .tour-btn.secondary {
            background: #f0f0f0;
            color: #666;
        }
        
        .tour-btn:hover {
            transform: translateY(-2px);
        }
        
        /* No Results State */
        .no-results {
            text-align: center;
            padding: 30px 20px;
            color: #666;
            font-style: italic;
            background: #f8f9fa;
            border-radius: 12px;
            margin: 10px 0;
            border: 2px dashed #e9ecef;
        }
        
        .no-results-icon {
            font-size: 2rem;
            margin-bottom: 10px;
            opacity: 0.5;
        }
        
        /* Image loading states */
        .workspace-image {
            transition: opacity 0.3s ease;
        }
        
        .workspace-image.loading {
            opacity: 0.6;
        }
        
        .workspace-image.loaded {
            opacity: 1;
        }
        
        .workspace-image.error {
            opacity: 0.3;
        }
        
        /* Enhanced workspace item with images */
        .workspace-item .workspace-image-container {
            position: relative;
            overflow: hidden;
            border-radius: 8px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }
        
        .workspace-item .workspace-image-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.3) 50%, transparent 70%);
            animation: shimmer 2s infinite;
            z-index: 1;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .workspace-item .workspace-image-container img {
            position: relative;
            z-index: 2;
        }
        
        /* No Results State */
        
        /* Custom workspace marker styling */
        .custom-div-icon {
            transition: all 0.3s ease;
        }
        
        .custom-div-icon:hover {
            transform: scale(1.1);
            filter: brightness(1.1);
        }
        
        .custom-div-icon img {
            transition: all 0.3s ease;
        }
        
        .custom-div-icon:hover img {
            transform: scale(1.05);
        }
        
        /* Pulse animation for workspace markers */
        .custom-div-icon.pulse {
            animation: markerPulse 0.6s ease-in-out;
        }
        
        @keyframes markerPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        
        /* Image loading states */
        
        /* Direction panel close button */
        .direction-panel .close-btn {
            background-color: white !important;
            border: none !important;
            font-size: 1.5rem !important;
            cursor: pointer !important;
            color: #666 !important;
            width: 32px !important;
            height: 32px !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            border-radius: 50% !important;
            transition: all 0.3s ease !important;
            position: relative !important;
            overflow: hidden !important;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1) !important;
        }
        
        .direction-panel .close-btn:hover {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%) !important;
            color: white !important;
            transform: scale(1.1) !important;
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3) !important;
        }
        
        .direction-panel .close-btn:active {
            transform: scale(0.95) !important;
        }
        
        .direction-panel .close-btn::before {
            content: '' !important;
            position: absolute !important;
            top: 50% !important;
            left: 50% !important;
            width: 0 !important;
            height: 0 !important;
            background: rgba(255, 255, 255, 0.2) !important;
            border-radius: 50% !important;
            transform: translate(-50%, -50%) !important;
            transition: all 0.3s ease !important;
        }
        
        .direction-panel .close-btn:hover::before {
            width: 100% !important;
            height: 100% !important;
        }
        
        .direction-panel .close-btn:focus {
            outline: 2px solid #ff6b6b !important;
            outline-offset: 2px !important;
        }
        
        /* Mobile responsive close buttons */
        .direction-panel .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
            padding: 8px;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .direction-panel .close-btn:hover {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
            color: white;
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
        }
        
        .direction-panel .close-btn:active {
            transform: scale(0.95);
        }
        
        .direction-panel .close-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: all 0.3s ease;
        }
        
        .direction-panel .close-btn:hover::before {
            width: 100%;
            height: 100%;
        }
        
        .direction-panel .close-btn:focus {
            outline: 2px solid #ff6b6b;
            outline-offset: 2px;
        }
        
        /* Mobile responsive direction panel */
        @media (max-width: 768px) {
            .direction-panel {
                position: fixed;
                bottom: 20px;
                left: 15px;
                right: 15px;
                width: auto;
                margin: 0;
                padding: 20px;
                min-width: auto;
                max-width: none;
                z-index: 1000;
                border-radius: 20px;
            }
            
            .direction-title {
                font-size: 1.2rem;
            }
            
            .direction-title::before {
                font-size: 1.3rem;
            }
            
            .direction-panel .close-btn {
                width: 42px;
                height: 42px;
                font-size: 1.3rem;
                padding: 12px;
            }
            
            .direction-item {
                padding: 14px 16px;
                margin-bottom: 10px;
            }
            
            .direction-label {
                font-size: 0.9rem;
            }
            
            .direction-value {
                font-size: 0.95rem;
                padding: 8px 12px;
            }
            
            .action-button {
                padding: 16px 20px;
                font-size: 1rem;
                min-height: 50px;
                border-radius: 12px;
            }
        }
        
        /* Very small screens */
        @media (max-width: 480px) {
            .direction-panel {
                bottom: 15px;
                left: 10px;
                right: 10px;
                padding: 18px;
                border-radius: 16px;
            }
            
            .direction-title {
                font-size: 1.1rem;
            }
            
            .direction-title::before {
                font-size: 1.2rem;
            }
            
            .direction-panel .close-btn {
                width: 38px;
                height: 38px;
                font-size: 1.2rem;
                padding: 10px;
            }
            
            .direction-item {
                padding: 12px 14px;
                margin-bottom: 8px;
            }
            
            .direction-label {
                font-size: 0.85rem;
            }
            
            .direction-value {
                font-size: 0.9rem;
                padding: 6px 10px;
            }
            
            .action-button {
                padding: 14px 18px;
                font-size: 0.95rem;
                min-height: 48px;
            }
        }
        
        /* Custom Popup Styling */
        .custom-popup .leaflet-popup-content-wrapper {
            background: transparent;
            box-shadow: none;
            border-radius: 0;
            padding: 0;
        }
        
        .custom-popup .leaflet-popup-content {
            margin: 0;
            padding: 0;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
            background: white;
        }
        
        .custom-popup .leaflet-popup-tip {
            background: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        /* Popup Close Button Styling */
        .custom-popup button[onclick*="remove()"] {
            position: absolute !important;
            top: 15px !important;
            right: 15px !important;
            background: linear-gradient(135deg, #5baa91 0%, rgba(102, 161, 133, 1) 100%) !important;
            border: none !important;
            color: white !important;
            width: 35px !important;
            height: 35px !important;
            border-radius: 50% !important;
            cursor: pointer !important;
            font-size: 1.2rem !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            z-index: 1000 !important;
            transition: all 0.3s ease !important;
            box-shadow: 0 4px 12px rgba(91, 170, 145, 0.3) !important;
            font-weight: bold !important;
        }
        
        .custom-popup button[onclick*="remove()"]:hover {
            background: linear-gradient(135deg, #4a8c7a 0%, #3a7a6a 100%) !important;
            transform: scale(1.1) !important;
            box-shadow: 0 6px 20px rgba(91, 170, 145, 0.4) !important;
        }
        
        .custom-popup button[onclick*="remove()"]:active {
            transform: scale(0.95) !important;
        }
        
        .custom-popup button[onclick*="remove()"]::before {
            content: '' !important;
            position: absolute !important;
            top: 50% !important;
            left: 50% !important;
            width: 0 !important;
            height: 0 !important;
            background: rgba(255, 255, 255, 0.2) !important;
            border-radius: 50% !important;
            transform: translate(-50%, -50%) !important;
            transition: all 0.3s ease !important;
        }
        
        .custom-popup button[onclick*="remove()"]:hover::before {
            width: 100% !important;
            height: 100% !important;
        }
        
        .custom-popup button[onclick*="remove()"]:focus {
            outline: 2px solid #5baa91 !important;
            outline-offset: 2px !important;
        }
        
        /* Popup Action Button Styling */
        .custom-popup button[onclick*="showDirectionPanelById"] {
            width: 100% !important;
            padding: 15px 20px !important;
            background: linear-gradient(135deg, #5baa91 0%, rgba(102, 161, 133, 1) 100%) !important;
            color: white !important;
            border: none !important;
            border-radius: 12px !important;
            cursor: pointer !important;
            font-family: 'Cairo', sans-serif !important;
            font-weight: 700 !important;
            font-size: 1.1rem !important;
            transition: all 0.3s ease !important;
            box-shadow: 0 6px 20px rgba(91, 170, 145, 0.3) !important;
            position: relative !important;
            overflow: hidden !important;
        }
        
        .custom-popup button[onclick*="showDirectionPanelById"]::before {
            content: '' !important;
            position: absolute !important;
            top: 0 !important;
            left: -100% !important;
            width: 100% !important;
            height: 100% !important;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent) !important;
            transition: left 0.5s ease !important;
        }
        
        .custom-popup button[onclick*="showDirectionPanelById"]:hover {
            transform: translateY(-3px) !important;
            box-shadow: 0 8px 25px rgba(91, 170, 145, 0.4) !important;
        }
        
        .custom-popup button[onclick*="showDirectionPanelById"]:hover::before {
            left: 100% !important;
        }
        
        .custom-popup button[onclick*="showDirectionPanelById"]:active {
            transform: translateY(-1px) !important;
        }
        
        /* Shimmer Animation for Popup Header */
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        /* Popup Content Hover Effects */
        .custom-popup .leaflet-popup-content > div > div:hover {
            transform: translateY(-2px);
            transition: transform 0.3s ease;
        }
        
        /* Mobile Responsive Popup */
        @media (max-width: 768px) {
            .custom-popup .leaflet-popup-content {
                min-width: 280px !important;
                max-width: 320px !important;
            }
            
            .custom-popup button[onclick*="remove()"] {
                width: 36px !important;
                height: 36px !important;
                font-size: 1.4rem !important;
            }
            
            .custom-popup button[onclick*="showDirectionPanelById"] {
                padding: 16px 20px !important;
                font-size: 1rem !important;
                min-height: 50px !important;
            }
        }
        
        /* Leaflet Default Popup Close Button Styling */
        .leaflet-popup-close-button {
            background-color: white !important;
            border: none !important;
            font-size: 1.5rem !important;
            cursor: pointer !important;
            color: #666 !important;
            width: 32px !important;
            height: 32px !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            border-radius: 50% !important;
            transition: all 0.3s ease !important;
            position: relative !important;
            overflow: hidden !important;
            text-decoration: none !important;
            padding: 0 !important;
            margin: 0 !important;
            top: 8px !important;
            right: 8px !important;
            z-index: 1000 !important;
            opacity: 1 !important;
            visibility: visible !important;
        }
        
        .leaflet-popup-close-button:hover {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%) !important;
            color: white !important;
            transform: scale(1.1) !important;
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3) !important;
        }
        
        .leaflet-popup-close-button:active {
            transform: scale(0.95) !important;
        }
        
        .leaflet-popup-close-button::before {
            content: '' !important;
            position: absolute !important;
            top: 50% !important;
            left: 50% !important;
            width: 0 !important;
            height: 0 !important;
            background: rgba(255, 255, 255, 0.2) !important;
            border-radius: 50% !important;
            transform: translate(-50%, -50%) !important;
            transition: all 0.3s ease !important;
        }
        
        .leaflet-popup-close-button:hover::before {
            width: 100% !important;
            height: 100% !important;
        }
        
        .leaflet-popup-close-button:focus {
            outline: 2px solid #ff6b6b !important;
            outline-offset: 2px !important;
        }
        
        .leaflet-popup-close-button span {
            position: relative !important;
            z-index: 1 !important;
        }
        
        /* Ensure popup close button is always visible */
        .custom-popup .leaflet-popup-close-button {
            display: flex !important;
            opacity: 1 !important;
            visibility: visible !important;
        }
    </style>
</head>
<body>
    <header>
        <h1>ZenZone Map</h1>
        <div class="header-subtitle">Ø§ÙƒØªØ´Ù Ø£Ø­Ù„Ù‰ Ù…Ø³Ø§Ø­Ø§Øª Ø§Ù„Ø¹Ù…Ù„ ÙÙŠ Ø£Ø³ÙŠÙˆØ·</div>
    </header>

    <!-- Toggle Button for Stats Panel -->
    <button class="stats-toggle" id="statsToggle" onclick="toggleStatsPanel()" title="Ø´ÙˆÙ/Ø®Ø¨ÙŠ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª">
        ðŸ“Š
    </button>

    <!-- Collapsible Quick Stats Panel -->
    <div class="stats-card" id="statsCard">
        <div class="panel-header">
            <h3 class="panel-title">ðŸ“Š ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø³Ø§Ø­Ø§Øª</h3>
            <button class="panel-close" onclick="toggleStatsPanel()" title="Ù‚ÙÙ„ Ø§Ù„Ù„ÙˆØ­Ø©">Ã—</button>
        </div>
        
        <div class="panel-content">
            <!-- Search Component - First -->
            <div class="component-section">
                <div class="section-header">
                    <span class="section-icon">ðŸ”</span>
                    Ø¯ÙˆØ± Ø¹Ù„Ù‰ Ù…Ø³Ø§Ø­Ø© Ø¹Ù…Ù„
                </div>
                <div class="search-container">
                    <input type="text" id="searchInput" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø¹Ù…Ù„..." class="search-input">
                    <span class="search-icon">ðŸ”</span>
                </div>
            </div>
            
            <!-- Workspaces List Component - Results directly under search -->
            <div class="component-section">
                <div class="section-header">
                    <span class="section-icon">ðŸ¢</span>
                    Ù…Ø³Ø§Ø­Ø§Øª Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ù…ØªØ§Ø­Ø©
                </div>
                <div class="workspaces-list" id="workspacesList">
                    <!-- Workspace names will be populated here -->
                </div>
            </div>
            
            <!-- Route Options Component -->
            <div class="component-section">
                <div class="section-header">
                    <span class="section-icon">ðŸ§­</span>
                    Ø§Ø²Ø§ÙŠ ØªØ±ÙˆØ­
                </div>
                <div class="route-options">
                    <button class="route-btn active" onclick="toggleRouteType('driving')">ðŸš— Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</button>
                    <button class="route-btn" onclick="toggleRouteType('walking')">ðŸš¶ Ù…Ø§Ø´ÙŠ</button>
                    <button class="route-btn" onclick="toggleRouteType('cycling')">ðŸš´ Ø¨Ø§Ù„Ø¯Ø±Ø§Ø¬Ø©</button>
                    <button class="route-btn" onclick="toggleRouteType('motorcycle')">ðŸï¸ Ø¨Ø§Ù„Ù…ÙˆØªÙˆØ³ÙŠÙƒÙ„</button>
                </div>
            </div>
            
            <!-- Nearest Workspace Component -->
            <div class="nearest-workspace" id="nearestWorkspace" style="display: none;">
                <div class="nearest-title">ðŸ“ Ø£Ù‚Ø±Ø¨ Ù…Ø³Ø§Ø­Ø© Ø¹Ù…Ù„</div>
                <div class="nearest-name" id="nearestName">-</div>
                <div class="nearest-distance" id="nearestDistanceDisplay">-</div>
            </div>
            
            <!-- Quick Actions Component -->
            <div class="component-section">
                <div class="section-header">
                    <span class="section-icon">âš¡</span>
                    Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©
                </div>
                <div class="quick-actions">
                    <button class="quick-action-btn" onclick="getUserLocation()" title="Ø§Ø¹Ø±Ù Ù…ÙƒØ§Ù†ÙŠ">
                        <span class="quick-action-icon">ðŸ“</span>
                        <span class="quick-action-label">Ù…ÙƒØ§Ù†ÙŠ</span>
                    </button>
                    <button class="quick-action-btn" onclick="fitToBounds()" title="Ø´ÙˆÙ Ø§Ù„ÙƒÙ„">
                        <span class="quick-action-icon">ðŸ”</span>
                        <span class="quick-action-label">Ø´ÙˆÙ Ø§Ù„ÙƒÙ„</span>
                    </button>
                    <button class="quick-action-btn" onclick="clearRoute()" title="Ø§Ù…Ø³Ø­ Ø§Ù„Ù…Ø³Ø§Ø±">
                        <span class="quick-action-icon">ðŸ—‘ï¸</span>
                        <span class="quick-action-label">Ø§Ù…Ø³Ø­</span>
                    </button>
                </div>
            </div>
            
            <!-- Status Component -->
            <div class="component-section">
                <div class="section-header">
                    <span class="section-icon">ðŸ“Š</span>
                    Ø­Ø§Ù„Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹
                </div>
                <div class="status-grid">
                    <div class="status-item">
                        <div class="status-label">Ø§Ù„Ø­Ø§Ù„Ø©</div>
                        <div class="status-value" id="locationStatus">ðŸ“ Ø¬Ø§Ù‡Ø²</div>
                    </div>
                    <div class="status-item">
                        <div class="status-label">Ø§Ù„Ø¯Ù‚Ø©</div>
                        <div class="status-value" id="locationAccuracy">-</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="direction-panel" id="directionPanel">
        <div class="direction-header">
            <div class="direction-title">ðŸ§­ Ø§Ù„Ø§ØªØ¬Ø§Ù‡Ø§Øª</div>
            <button class="close-btn" onclick="closeDirectionPanel()">Ã—</button>
        </div>
        <div class="direction-info" id="directionInfo">
            <!-- Direction information will be populated here -->
        </div>
    </div>

    <button class="location-button" id="getLocation" title="Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…ÙˆÙ‚Ø¹ÙŠ">
        ðŸ“
    </button>

    <div id="map"></div>
    
    <!-- Progress Bar -->
    <div class="progress-bar" id="progressBar"></div>
    
    <!-- Toast Container -->
    <div id="toastContainer"></div>
    
    <!-- Floating Action Button -->
    <button class="fab" id="fab" onclick="toggleFabMenu()">
        <span id="fabIcon">+</span>
    </button>
    
    <!-- FAB Menu -->
    <div class="fab-menu" id="fabMenu">
        <button class="fab-item" onclick="getUserLocation()" title="Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…ÙˆÙ‚Ø¹ÙŠ">
            ðŸ“
        </button>
        <button class="fab-item" onclick="toggleTrackingPanel()" title="Ø§Ù„Ù…Ù„Ø§Ø­Ø© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©">
            ðŸ§­
        </button>
        <button class="fab-item" onclick="clearRoute()" title="Ù…Ø³Ø­ Ø§Ù„Ù…Ø³Ø§Ø±">
            ðŸ—‘ï¸
        </button>
        <button class="fab-item" onclick="fitToBounds()" title="Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©">
            ðŸ”
        </button>
        <button class="fab-item" onclick="toggleFullscreen()" title="Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©">
            â›¶
        </button>
    </div>

    <!-- Real-time Tracking Panel -->
    <div class="panel tracking-panel" id="trackingPanel">
        <div class="panel-header">
            <h3>ðŸ§­ Ø§Ù„Ù…Ù„Ø§Ø­Ø© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©</h3>
            <button class="panel-close" onclick="closeNavigationPanel()">Ã—</button>
        </div>
        <div class="tracking-content">
            <div class="tracking-status" id="trackingStatus">
                <div class="status-indicator">
                    <span class="status-dot" id="statusDot"></span>
                    <span id="statusText">Ø¬Ø§Ù‡Ø² Ù„Ù„Ù…Ù„Ø§Ø­Ø©</span>
                </div>
            </div>
            
            <div class="tracking-info">
                <div class="info-item">
                    <span class="info-label">Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©:</span>
                    <span class="info-value" id="remainingDistance">-</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹:</span>
                    <span class="info-value" id="eta">-</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Ø§Ù„Ø³Ø±Ø¹Ø©:</span>
                    <span class="info-value" id="currentSpeed">-</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Ø§Ù„Ø¯Ù‚Ø©:</span>
                    <span class="info-value" id="trackingAccuracy">-</span>
                </div>
            </div>
            
            <div class="navigation-instructions" id="navigationInstructions">
                <h4>Ø§Ù„Ù…Ù†Ø¹Ø·Ù Ø§Ù„ØªØ§Ù„ÙŠ</h4>
                <div class="instruction-card" id="currentInstruction">
                    <div class="instruction-icon">ðŸš¶</div>
                    <div class="instruction-text">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ù„Ø§Ø­Ø© Ù„Ù„Ø¨Ø¯Ø¡</div>
                </div>
            </div>
            
            <div class="tracking-controls">
                <button class="track-btn" id="startTrackingBtn" onclick="startRealTimeTracking()">
                    ðŸš€ Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ù„Ø§Ø­Ø©
                </button>
                <button class="track-btn secondary" onclick="pauseTracking()" id="pauseBtn" style="display: none;">
                    â¸ï¸ Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª
                </button>
                <button class="track-btn secondary" onclick="resumeTracking()" id="resumeBtn" style="display: none;">
                    â–¶ï¸ Ø§Ø³ØªØ¦Ù†Ø§Ù
                </button>
            </div>
        </div>
    </div>

    <!-- Help Tooltip -->
    <div class="help-tooltip" id="helpTooltip"></div>
    
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner-large"></div>
    </div>
    
    <!-- Welcome Tour -->
    <div class="welcome-tour" id="welcomeTour">
        <div class="tour-content">
            <div class="tour-title">ðŸŽ‰ Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ ZenZone!</div>
            <div class="tour-text">
                Ø§ÙƒØªØ´Ù Ù…Ø³Ø§Ø­Ø§Øª Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ù…Ø°Ù‡Ù„Ø© ÙÙŠ Ø£Ø³ÙŠÙˆØ· Ù…Ø¹ Ø®Ø±ÙŠØ·ØªÙ†Ø§ Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ©. 
                Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø§ØªØ¬Ø§Ù‡Ø§ØªØŒ Ø§Ø¨Ø­Ø« Ø¹Ù† Ø£Ù‚Ø±Ø¨ Ù…Ø³Ø§Ø­Ø© Ø¹Ù…Ù„ØŒ ÙˆØ§Ù†ØªÙ‚Ù„ ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„ÙØ¹Ù„ÙŠ.
            </div>
            <div class="tour-buttons">
                <button class="tour-btn secondary" onclick="skipTour()">ØªØ®Ø·ÙŠ</button>
                <button class="tour-btn primary" onclick="startTour()">Ø§Ø¨Ø¯Ø£</button>
            </div>
        </div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script>
        // Simple initialization
        console.log('Starting map initialization...');
        
        // Initialize map
        const map = L.map('map').setView([27.1828, 31.1828], 12);
        console.log('Map created');
        
        // Add tile layer
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '',
            subdomains: 'abc',
            maxZoom: 19
        }).addTo(map);
        console.log('Tile layer added');
        
        // Workspace data
        const workspaces = [
            {
                id: 1,
                name: "ZenZone ÙˆØ³Ø· Ø§Ù„Ø¨Ù„Ø¯",
                lat: 27.1828,
                lng: 31.1828,
                description: "Ù…Ø³Ø§Ø­Ø© Ø¹Ù…Ù„ Ø¬Ø§Ù…Ø¯Ø© ÙÙŠ ÙˆØ³Ø· Ø£Ø³ÙŠÙˆØ· Ù…Ø¹ Ø¥Ù†ØªØ±Ù†Øª Ø³Ø±ÙŠØ¹ ÙˆØºØ±Ù Ø§Ø¬ØªÙ…Ø§Ø¹Ø§Øª.",
                badge: "Ù…Ù…ÙŠØ²",
                dir: "downtown",
                img: "main.jpg"
            },
            {
                id: 2,
                name: "ZenZone Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©",
                lat: 27.1750,
                lng: 31.1900,
                description: "Ù…Ø«Ø§Ù„ÙŠØ© Ù„Ù„Ø·Ù„Ø¨Ø© ÙˆØ§Ù„Ø£Ø³Ø§ØªØ°Ø© Ù‚Ø±ÙŠØ¨Ø© Ù…Ù† Ø¬Ø§Ù…Ø¹Ø© Ø£Ø³ÙŠÙˆØ·.",
                badge: "Ø·Ù„Ø§Ø¨ÙŠ",
                dir: "university",
                img: "campus.jpg"
            },
            {
                id: 3,
                name: "ZenZone Ø§Ù„Ù…ÙˆÙ„",
                lat: 27.1950,
                lng: 31.1700,
                description: "Ù…ÙˆÙ‚Ø¹ Ø­Ù„Ùˆ Ù‚Ø±ÙŠØ¨ Ù…Ù† Ø§Ù„Ù…ÙˆÙ„Ø§Øª Ù…Ø¹ Ø¯Ø®ÙˆÙ„ 24 Ø³Ø§Ø¹Ø©.",
                badge: "24/7",
                dir: "alnagah",
                img: "Alnagah.jpg"
            },
            {
                id: 4,
                name: "ZenZone Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØµÙ†Ø§Ø¹ÙŠØ©",
                lat: 27.1600,
                lng: 31.2000,
                description: "Ù…Ø³Ø§Ø­Ø© Ø¹Ù…Ù„ ÙÙŠ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØµÙ†Ø§Ø¹ÙŠØ© Ù…Ø¹ Ù…ÙˆÙ‚Ù Ø³ÙŠØ§Ø±Ø§Øª ÙˆØ£Ù…Ø§Ù†.",
                badge: "Ø¢Ù…Ù†",
                dir: "noon",
                img: "noon.jpg"
            }
        ];
        
        let userLocation = null;
        let userMarker = null;
        let selectedWorkspace = null;
        let routePolyline = null;
        let routeMarkers = [];
        let locationWatchId = null;
        let locationAccuracy = null;
        let isTracking = false;
        let trackingPath = [];
        let trackingPolyline = null;
        let currentRouteIndex = 0;
        let routeInstructions = [];
        
        // Custom workspace icon with actual image
        function createWorkspaceIcon(workspace) {
            const imageUrl = getWorkspaceImageUrl(workspace);
            const fallbackIcon = 'ðŸ¢';
            
            if (imageUrl) {
                return L.divIcon({
                    html: `<div style="width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 6px 20px rgba(91, 170, 145, 0.5); border: 4px solid white; position: relative; background: white; overflow: hidden;">
                            <img src="${imageUrl}" alt="${workspace.name}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                            <div style="display: none; align-items: center; justify-content: center; width: 100%; height: 100%; background: linear-gradient(135deg, #5baa91 0%, rgba(102, 161, 133, 1) 100%); color: white; font-size: 20px; border-radius: 50%;">${fallbackIcon}</div>
                            <div style="position: absolute; bottom: -8px; left: 50%; transform: translateX(-50%); background: white; padding: 2px 8px; border-radius: 10px; font-size: 10px; font-weight: 600; color: #5baa91; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">WORK</div>
                           </div>`,
                    className: 'custom-div-icon',
                    iconSize: [50, 58],
                    iconAnchor: [25, 29],
                    popupAnchor: [0, -29]
                });
            } else {
                // Fallback to original design if no image
                return L.divIcon({
                    html: `<div style="background: linear-gradient(135deg, #5baa91 0%, rgba(102, 161, 133, 1) 100%); width: 45px; height: 45px; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 6px 20px rgba(91, 170, 145, 0.5); border: 4px solid white; position: relative;">
                            <span style="color: white; font-size: 20px;">${fallbackIcon}</span>
                            <div style="position: absolute; bottom: -8px; left: 50%; transform: translateX(-50%); background: white; padding: 2px 8px; border-radius: 10px; font-size: 10px; font-weight: 600; color: #5baa91; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">WORK</div>
                           </div>`,
                    className: 'custom-div-icon',
                    iconSize: [45, 53],
                    iconAnchor: [22, 26],
                    popupAnchor: [0, -26]
                });
            }
        }
        
        // User location icon
        const userLocationIcon = L.divIcon({
            html: `<div style="background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); width: 35px; height: 35px; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 6px 20px rgba(220, 53, 69, 0.5); border: 4px solid white; position: relative;">
                    <span style="color: white; font-size: 18px;">ðŸ“</span>
                    <div style="position: absolute; top: -8px; left: 50%; transform: translateX(-50%); background: white; padding: 2px 8px; border-radius: 10px; font-size: 10px; font-weight: 600; color: #dc3545; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">YOU</div>
                   </div>`,
            className: 'user-location-icon',
            iconSize: [35, 43],
            iconAnchor: [17, 21]
        });
        
        // Get workspace image URL
        function getWorkspaceImageUrl(workspace) {
            if (workspace.dir && workspace.img) {
                return `https://zenzone.flexispace.space/workspaces/${workspace.dir}/${workspace.img}`;
            }
            return null;
        }
        
        // Add workspaces to map
        workspaces.forEach(ws => {
            const marker = L.marker([ws.lat, ws.lng], { icon: createWorkspaceIcon(ws) }).addTo(map);
            ws.marker = marker;
            
            // Add enhanced click handler
            addWorkspaceClickHandler(ws, marker);
            
            marker.bindPopup(`
                <div style="font-family: 'Cairo', sans-serif; min-width: 300px; max-width: 350px; position: relative;">
                    <!-- Header -->
                    <div style="background: linear-gradient(135deg, #5baa91 0%, rgba(102, 161, 133, 1) 100%); 
                                margin: -15px -15px 20px -15px; padding: 25px 20px 20px 20px; 
                                color: white; border-radius: 12px 12px 0 0; position: relative; overflow: hidden;">
                        <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; 
                                    background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.1) 50%, transparent 70%); 
                                    animation: shimmer 2s infinite;"></div>
                        <div style="font-size: 1.3rem; font-weight: 700; margin-bottom: 10px; position: relative; z-index: 1;">${ws.name}</div>
                        <div style="background: rgba(255,255,255,0.2); padding: 6px 14px; border-radius: 20px; 
                                    font-size: 0.9rem; display: inline-block; font-weight: 600; position: relative; z-index: 1;">${ws.badge}</div>
                    </div>
                    
                    <!-- Image Section -->
                    ${getWorkspaceImageUrl(ws) ? `
                        <div style="margin-bottom: 20px; border-radius: 12px; overflow: hidden; box-shadow: 0 6px 20px rgba(0,0,0,0.15); position: relative;">
                            <img src="${getWorkspaceImageUrl(ws)}" alt="${ws.name}" 
                                 style="width: 100%; height: 180px; object-fit: cover; display: block;" 
                                 onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                            <div style="display: none; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); 
                                        padding: 80px 20px; text-align: center; color: #666; font-size: 1rem; border-radius: 12px;">
                                <div style="font-size: 3rem; margin-bottom: 15px;">ðŸ¢</div>
                                <div>ØµÙˆØ±Ø© Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø¹Ù…Ù„</div>
                            </div>
                        </div>
                    ` : `
                        <div style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); 
                                    padding: 50px 20px; text-align: center; color: #666; font-size: 1rem; 
                                    border-radius: 12px; margin-bottom: 20px; border: 2px dashed #dee2e6;">
                            <div style="font-size: 3rem; margin-bottom: 15px;">ðŸ¢</div>
                            <div>Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø¹Ù…Ù„</div>
                        </div>
                    `}
                    
                    <!-- Description -->
                    <div style="margin-bottom: 20px; line-height: 1.6; color: #333; font-size: 1rem; 
                                padding: 15px; background: #f8f9fa; border-radius: 10px; border-left: 4px solid #5baa91;">${ws.description}</div>
                    
                    <!-- Address Section -->
                    <div style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); 
                                padding: 15px; border-radius: 12px; margin-bottom: 20px; 
                                border-left: 4px solid #5baa91; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                        <div style="font-weight: 700; color: #5baa91; margin-bottom: 8px; font-size: 0.95rem; display: flex; align-items: center; gap: 8px;">
                            ðŸ“ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
                        </div>
                        <div style="color: #555; font-size: 0.95rem; margin-bottom: 5px;">Ø£Ø³ÙŠÙˆØ·ØŒ Ù…ØµØ±</div>
                        <div style="color: #888; font-size: 0.85rem;">Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª: ${ws.lat.toFixed(4)}, ${ws.lng.toFixed(4)}</div>
                    </div>
                    
                    <!-- Single Action Button -->
                    <button onclick="showDirectionPanelById(${ws.id})" 
                            style="width: 100%; padding: 15px 20px; background: linear-gradient(135deg, #5baa91 0%, rgba(102, 161, 133, 1) 100%); 
                                   color: white; border: none; border-radius: 12px; cursor: pointer; 
                                   font-family: 'Cairo', sans-serif; font-weight: 700; font-size: 1.1rem; 
                                   transition: all 0.3s ease; box-shadow: 0 6px 20px rgba(91, 170, 145, 0.3);
                                   position: relative; overflow: hidden; margin-bottom: 10px;">
                        <span style="position: relative; z-index: 1;">ðŸ§­ Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø§ØªØ¬Ø§Ù‡Ø§Øª</span>
                        <div style="position: absolute; top: 0; left: -100%; width: 100%; height: 100%; 
                                    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent); 
                                    transition: left 0.5s ease;"></div>
                    </button>
                </div>
            `, {
                maxWidth: 350,
                className: 'custom-popup',
                closeButton: true
            });
        });
        
        console.log('Workspaces added to map');
        
        // Calculate distance function
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371;
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                      Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }
        
        // Format distance function
        function formatDistance(distance) {
            if (distance < 1) {
                return `${Math.round(distance * 1000)}m`;
            } else {
                return `${distance.toFixed(1)}km`;
            }
        }
        
        // Get bearing function
        function getBearing(lat1, lon1, lat2, lon2) {
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const lat1Rad = lat1 * Math.PI / 180;
            const lat2Rad = lat2 * Math.PI / 180;
            
            const y = Math.sin(dLon) * Math.cos(lat2Rad);
            const x = Math.cos(lat1Rad) * Math.sin(lat2Rad) - Math.sin(lat1Rad) * Math.cos(lat2Rad) * Math.cos(dLon);
            
            let bearing = Math.atan2(y, x) * 180 / Math.PI;
            bearing = (bearing + 360) % 360;
            
            return bearing;
        }
        
        // Get direction name function
        function getDirectionName(bearing) {
            const directions = ['North', 'Northeast', 'East', 'Southeast', 'South', 'Southwest', 'West', 'Northwest'];
            const index = Math.round(bearing / 45) % 8;
            return directions[index];
        }
        
        // Show direction panel function
        function showDirectionPanel(workspace) {
            if (!userLocation) {
                showToast('Please get your location first to see directions.', 'warning');
                return;
            }
            
            selectedWorkspace = workspace;
            const distance = calculateDistance(userLocation[0], userLocation[1], workspace.lat, workspace.lng);
            const bearing = getBearing(userLocation[0], userLocation[1], workspace.lat, workspace.lng);
            const direction = getDirectionName(bearing);
            
            // Create route with current route type
            createRoute(userLocation, [workspace.lat, workspace.lng], currentRouteType);
            
            const directionInfo = document.getElementById('directionInfo');
            directionInfo.innerHTML = `
                <div class="direction-item">
                    <span class="direction-label">ðŸ“ Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©</span>
                    <span class="direction-value">${formatDistance(distance)}</span>
                </div>
                <div class="direction-item">
                    <span class="direction-label">ðŸ§­ Ø§Ù„Ø§ØªØ¬Ø§Ù‡</span>
                    <span class="direction-value">${direction}</span>
                </div>
                <div class="direction-item">
                    <span class="direction-label">ðŸ“ Ø§Ù„Ø²Ø§ÙˆÙŠØ©</span>
                    <span class="direction-value">${Math.round(bearing)}Â°</span>
                </div>
                <div class="direction-item">
                    <span class="direction-label">ðŸŒ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª</span>
                    <span class="direction-value">${workspace.lat.toFixed(4)}, ${workspace.lng.toFixed(4)}</span>
                </div>
            `;
            
            document.getElementById('directionPanel').classList.add('show');
            
            // Show tracking panel option
            showToast(`${currentRouteType.charAt(0).toUpperCase() + currentRouteType.slice(1)} route to ${workspace.name} ready! Click ðŸ§­ for live navigation`, 'success');
        }
        
        // Helper functions for route styling
        function getRouteColor(routeType) {
            switch(routeType) {
                case 'driving': return '#5baa91';
                case 'walking': return '#ff6b35';
                case 'cycling': return '#4ecdc4';
                case 'motorcycle': return '#45b7d1';
                default: return '#5baa91';
            }
        }
        
        function getRoutePattern(routeType) {
            switch(routeType) {
                case 'driving': return '20, 10';
                case 'walking': return '5, 5';
                case 'cycling': return '15, 8';
                case 'motorcycle': return '25, 12';
                default: return '20, 10';
            }
        }
        
        // Create route function
        function createRoute(start, end, routeType = 'driving') {
            // Clear previous route
            if (routePolyline) {
                map.removeLayer(routePolyline);
            }
            routeMarkers.forEach(marker => map.removeLayer(marker));
            routeMarkers = [];
            
            // Show loading state
            const directionInfo = document.getElementById('directionInfo');
            directionInfo.innerHTML = '<div style="text-align: center; padding: 20px;"><div class="loading-spinner"></div><br>Calculating route...</div>';
            showProgress(30);
            showToast(`Calculating ${routeType} route...`, 'info');
            
            // Use OSRM (Open Source Routing Machine) for real street routing
            const apiUrl = `https://router.project-osrm.org/route/v1/${routeType}/${start[1]},${start[0]};${end[1]},${end[0]}?overview=full&geometries=geojson&steps=true`;
            
            fetch(apiUrl)
            .then(response => {
                showProgress(60);
                if (!response.ok) {
                    throw new Error('Routing API failed');
                }
                return response.json();
            })
            .then(data => {
                showProgress(90);
                if (data.routes && data.routes.length > 0) {
                    const route = data.routes[0];
                    const coordinates = route.geometry.coordinates.map(coord => [coord[1], coord[0]]); // Convert to [lat, lng]
                    
                    // Create polyline for the route
                    routePolyline = L.polyline(coordinates, {
                        color: getRouteColor(routeType),
                        weight: 6,
                        opacity: 0.8,
                        dashArray: getRoutePattern(routeType),
                        lineCap: 'round',
                        lineJoin: 'round'
                    }).addTo(map);
                    
                    // Fit map to show entire route
                    const bounds = L.latLngBounds(coordinates);
                    map.fitBounds(bounds, { padding: [20, 20] });
                    
                    // Calculate realistic travel time based on route type
                    const distance = route.distance / 1000; // Convert to km
                    const calculatedDuration = calculateTravelTime(distance, routeType);
                    
                    const directionInfo = document.getElementById('directionInfo');
                    directionInfo.innerHTML = `
                        <div class="direction-item">
                            <span class="direction-label">ðŸš— Ù…Ø³Ø§Ø± ${routeType === 'driving' ? 'Ø¨Ø§Ù„Ø³ÙŠØ§Ø±Ø©' : routeType === 'walking' ? 'Ù…Ø§Ø´ÙŠ' : routeType === 'cycling' ? 'Ø¨Ø§Ù„Ø¯Ø±Ø§Ø¬Ø©' : 'Ø¨Ø§Ù„Ù…ÙˆØªÙˆØ³ÙŠÙƒÙ„'}</span>
                            <span class="direction-value">${formatDistance(distance)}</span>
                        </div>
                        <div class="direction-item">
                            <span class="direction-label">â±ï¸ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹</span>
                            <span class="direction-value">${formatTravelTime(calculatedDuration)}</span>
                        </div>
                        <div class="direction-item">
                            <span class="direction-label">âš¡ Ø§Ù„Ø³Ø±Ø¹Ø© Ø§Ù„Ù…ØªÙˆØ³Ø·Ø©</span>
                            <span class="direction-value">${getAverageSpeed(routeType)}</span>
                        </div>
                        <div class="direction-item">
                            <span class="direction-label">ðŸŽ¯ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³Ø§Ø±</span>
                            <span class="direction-value">${routeType === 'driving' ? 'Ø³ÙŠØ§Ø±Ø©' : routeType === 'walking' ? 'Ù…Ø´ÙŠ' : routeType === 'cycling' ? 'Ø¯Ø±Ø§Ø¬Ø©' : 'Ù…ÙˆØªÙˆØ³ÙŠÙƒÙ„'}</span>
                        </div>
                        <div class="direction-item">
                            <span class="direction-label">ðŸŒ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª</span>
                            <span class="direction-value">${end[0].toFixed(4)}, ${end[1].toFixed(4)}</span>
                        </div>
                    `;
                    
                    showProgress(100);
                    setTimeout(hideProgress, 500);
                    showToast(`${routeType.charAt(0).toUpperCase() + routeType.slice(1)} route calculated!`, 'success');
                } else {
                    throw new Error('No route found');
                }
            })
            .catch(error => {
                console.error('Routing error:', error);
                hideProgress();
                showToast('Using fallback route - street data unavailable', 'warning');
                
                // Fallback to simple straight line route
                const waypoints = [start, end];
                routePolyline = L.polyline(waypoints, {
                    color: getRouteColor(routeType),
                    weight: 6,
                    opacity: 0.8,
                    dashArray: getRoutePattern(routeType),
                    lineCap: 'round',
                    lineJoin: 'round'
                }).addTo(map);
                
                const bounds = L.latLngBounds(waypoints);
                map.fitBounds(bounds, { padding: [20, 20] });
                
                // Show fallback info with calculated travel time
                const distance = calculateDistance(start[0], start[1], end[0], end[1]);
                const calculatedDuration = calculateTravelTime(distance, routeType);
                const fallbackBearing = getBearing(start[0], start[1], end[0], end[1]);
                const direction = getDirectionName(fallbackBearing);
                
                const directionInfo = document.getElementById('directionInfo');
                directionInfo.innerHTML = `
                    <div class="direction-item">
                        <span class="direction-label">ðŸ“ Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©</span>
                        <span class="direction-value">${formatDistance(distance)}</span>
                    </div>
                    <div class="direction-item">
                        <span class="direction-label">â±ï¸ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹</span>
                        <span class="direction-value">${formatTravelTime(calculatedDuration)}</span>
                    </div>
                    <div class="direction-item">
                        <span class="direction-label">âš¡ Ø§Ù„Ø³Ø±Ø¹Ø© Ø§Ù„Ù…ØªÙˆØ³Ø·Ø©</span>
                        <span class="direction-value">${getAverageSpeed(routeType)}</span>
                    </div>
                    <div class="direction-item">
                        <span class="direction-label">ðŸ§­ Ø§Ù„Ø§ØªØ¬Ø§Ù‡</span>
                        <span class="direction-value">${direction}</span>
                    </div>
                    <div class="direction-item">
                        <span class="direction-label">ðŸ“ Ø§Ù„Ø²Ø§ÙˆÙŠØ©</span>
                        <span class="direction-value">${Math.round(fallbackBearing)}Â°</span>
                    </div>
                    <div class="direction-item">
                        <span class="direction-label">ðŸŒ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª</span>
                        <span class="direction-value">${end[0].toFixed(4)}, ${end[1].toFixed(4)}</span>
                    </div>
                `;
            });
        }
        
        // Calculate travel time based on route type and distance
        function calculateTravelTime(distanceKm, routeType) {
            const speeds = {
                driving: 30,      // 30 km/h average in city traffic
                walking: 5,       // 5 km/h walking speed
                cycling: 15,      // 15 km/h cycling speed
                motorcycle: 25    // 25 km/h motorcycle in city traffic
            };
            
            const speed = speeds[routeType] || speeds.driving;
            const timeHours = distanceKm / speed;
            const timeMinutes = timeHours * 60;
            
            return timeMinutes;
        }
        
        // Format travel time for display
        function formatTravelTime(minutes) {
            if (minutes < 1) {
                return `${Math.round(minutes * 60)} sec`;
            } else if (minutes < 60) {
                return `${Math.round(minutes)} min`;
            } else {
                const hours = Math.floor(minutes / 60);
                const remainingMinutes = Math.round(minutes % 60);
                if (remainingMinutes === 0) {
                    return `${hours} hr`;
                } else {
                    return `${hours} hr ${remainingMinutes} min`;
                }
            }
        }
        
        // Get average speed for route type
        function getAverageSpeed(routeType) {
            const speeds = {
                driving: '30 km/h',
                walking: '5 km/h',
                cycling: '15 km/h',
                motorcycle: '25 km/h'
            };
            
            return speeds[routeType] || speeds.driving;
        }
        
        // Show direction panel by ID function
        function showDirectionPanelById(workspaceId) {
            const workspace = workspaces.find(ws => ws.id === workspaceId);
            if (workspace) {
                showDirectionPanel(workspace);
            }
        }
        
        // Close direction panel function
        function closeDirectionPanel() {
            document.getElementById('directionPanel').classList.remove('show');
            selectedWorkspace = null;
            
            // Clear route from map
            if (routePolyline) {
                map.removeLayer(routePolyline);
                routePolyline = null;
            }
            routeMarkers.forEach(marker => map.removeLayer(marker));
            routeMarkers = [];
        }
        
        // Get user location function
        function getUserLocation() {
            const button = document.getElementById('getLocation');
            const statusElement = document.getElementById('locationStatus');
            
            button.disabled = true;
            button.textContent = 'â³';
            statusElement.textContent = 'â³ Locating...';
            showProgress(25);
            showToast('Getting your location...', 'info');
            
            if (navigator.geolocation) {
                const options = {
                    enableHighAccuracy: true,
                    timeout: 15000,
                    maximumAge: 0
                };
                
                // Get initial position
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        updateUserLocation(position);
                        button.textContent = 'ðŸ“';
                        button.disabled = false;
                        statusElement.textContent = 'âœ… Located';
                        showProgress(100);
                        setTimeout(hideProgress, 500);
                        showToast('Location found!', 'success');
                        
                        // Start continuous tracking
                        startLocationTracking();
                    },
                    function(error) {
                        handleLocationError(error);
                        button.textContent = 'ðŸ“';
                        button.disabled = false;
                        statusElement.textContent = 'âŒ Error';
                        hideProgress();
                        showToast('Location access denied', 'error');
                    },
                    options
                );
            } else {
                alert('Geolocation is not supported by this browser.');
                button.textContent = 'ðŸ“';
                button.disabled = false;
                statusElement.textContent = 'âŒ Not Supported';
                hideProgress();
                showToast('Geolocation not supported', 'error');
            }
        }
        
        // Update user location
        function updateUserLocation(position) {
            userLocation = [position.coords.latitude, position.coords.longitude];
            locationAccuracy = position.coords.accuracy;
            
            if (userMarker) {
                map.removeLayer(userMarker);
            }
            userMarker = L.marker(userLocation, { icon: userLocationIcon }).addTo(map);
            
            // Add accuracy circle
            if (locationAccuracy) {
                const accuracyCircle = L.circle(userLocation, {
                    radius: locationAccuracy,
                    color: '#5baa91',
                    fillColor: '#5baa91',
                    fillOpacity: 0.1,
                    weight: 1
                }).addTo(map);
                
                // Remove accuracy circle after 3 seconds
                setTimeout(() => {
                    map.removeLayer(accuracyCircle);
                }, 3000);
            }
            
            // Update nearest distance
            let nearestDistance = Infinity;
            workspaces.forEach(ws => {
                const distance = calculateDistance(userLocation[0], userLocation[1], ws.lat, ws.lng);
                if (distance < nearestDistance) {
                    nearestDistance = distance;
                }
            });
            
            // Update nearest workspace display
            updateNearestWorkspace();
            
            // Update accuracy display
            const accuracyElement = document.getElementById('locationAccuracy');
            if (accuracyElement && locationAccuracy) {
                accuracyElement.textContent = `Â±${Math.round(locationAccuracy)}m`;
                accuracyElement.style.color = locationAccuracy < 10 ? '#4CAF50' : locationAccuracy < 50 ? '#FF9800' : '#F44336';
            }
        }
        
        // Start continuous location tracking
        function startLocationTracking() {
            if (locationWatchId) {
                navigator.geolocation.clearWatch(locationWatchId);
            }
            
            const options = {
                enableHighAccuracy: true,
                timeout: 10000,
                maximumAge: 30000 // Update every 30 seconds max
            };
            
            locationWatchId = navigator.geolocation.watchPosition(
                function(position) {
                    updateUserLocation(position);
                },
                function(error) {
                    console.warn('Location tracking error:', error);
                },
                options
            );
        }
        
        // Handle location errors
        function handleLocationError(error) {
            console.error('Error getting location:', error);
            let errorMessage = 'Unable to get your location. ';
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    errorMessage += 'Please allow location access in your browser settings.';
                    break;
                case error.POSITION_UNAVAILABLE:
                    errorMessage += 'Location information is unavailable.';
                    break;
                case error.TIMEOUT:
                    errorMessage += 'Location request timed out.';
                    break;
                default:
                    errorMessage += 'Please check your browser settings.';
            }
            alert(errorMessage);
        }
        
        // Add event listener to location button
        document.getElementById('getLocation').addEventListener('click', getUserLocation);
        
        // Initialize stats
        // document.getElementById('workspaceCount').textContent = workspaces.length;
        
        // Populate workspace list
        function populateWorkspaceList() {
            const workspacesList = document.getElementById('workspacesList');
            if (!workspacesList) {
                console.error('Workspaces list container not found!');
                return;
            }
            
            console.log('Populating workspace list with', workspaces.length, 'workspaces');
            
            workspacesList.innerHTML = '';
            
            workspaces.forEach((ws, index) => {
                const workspaceItem = document.createElement('div');
                workspaceItem.className = 'workspace-item';
                workspaceItem.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 12px; flex: 1;">
                        <div style="width: 50px; height: 50px; border-radius: 8px; overflow: hidden; flex-shrink: 0; background: #f8f9fa; display: flex; align-items: center; justify-content: center;">
                            ${getWorkspaceImageUrl(ws) ? `
                                <img src="${getWorkspaceImageUrl(ws)}" alt="${ws.name}" style="width: 100%; height: 100%; object-fit: cover;" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                <div style="display: none; align-items: center; justify-content: center; width: 100%; height: 100%; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); color: #666; font-size: 1.2rem;">ðŸ¢</div>
                            ` : `
                                <div style="display: flex; align-items: center; justify-content: center; width: 100%; height: 100%; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); color: #666; font-size: 1.2rem;">ðŸ¢</div>
                            `}
                        </div>
                        <div style="flex: 1; min-width: 0;">
                            <div class="workspace-name" style="margin-bottom: 4px;">${ws.name}</div>
                            <div style="font-size: 0.8rem; color: #666; line-height: 1.3;">${ws.description.substring(0, 60)}${ws.description.length > 60 ? '...' : ''}</div>
                        </div>
                    </div>
                    <span class="workspace-badge">${ws.badge}</span>
                `;
                
                workspaceItem.addEventListener('click', () => {
                    console.log('Workspace clicked:', ws.name);
                    
                    // Add haptic feedback
                    hapticFeedback();
                    
                    // Remove previous selection
                    document.querySelectorAll('.workspace-item').forEach(item => {
                        item.classList.remove('selected');
                    });
                    
                    // Add selection to current item
                    workspaceItem.classList.add('selected');
                    
                    // Use enhanced click function
                    enhancedWorkspaceClick(ws);
                    
                    // Show success feedback
                    showSuccessFeedback(workspaceItem);
                });
                
                // Add hover tooltip
                workspaceItem.addEventListener('mouseenter', () => {
                    if (window.innerWidth > 768) {
                        showTooltip(workspaceItem, `Ø§Ù†Ù‚Ø± Ù„Ø¹Ø±Ø¶ ${ws.name}`, 2000);
                    }
                });
                
                workspacesList.appendChild(workspaceItem);
            });
            
            console.log('Workspace list populated successfully');
        }
        
        // Search functionality
        function setupSearch() {
            const searchInput = document.getElementById('searchInput');
            if (!searchInput) {
                console.error('Search input not found!');
                return;
            }
            
            console.log('Setting up search functionality...');
            
            searchInput.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase().trim();
                const workspaceItems = document.querySelectorAll('.workspace-item');
                
                console.log('Search term:', searchTerm, 'Items found:', workspaceItems.length);
                
                if (searchTerm === '') {
                    // Show all items if search is empty
                    workspaceItems.forEach(item => {
                        item.style.display = 'flex';
                        item.style.opacity = '1';
                    });
                    
                    // Update section header
                    updateWorkspaceSectionHeader(workspaces.length, false);
                    return;
                }
                
                let hasResults = false;
                let resultCount = 0;
                
                workspaceItems.forEach((item, index) => {
                    const workspaceName = workspaces[index].name.toLowerCase();
                    const workspaceDesc = workspaces[index].description.toLowerCase();
                    const workspaceBadge = workspaces[index].badge.toLowerCase();
                    
                    if (workspaceName.includes(searchTerm) || 
                        workspaceDesc.includes(searchTerm) || 
                        workspaceBadge.includes(searchTerm)) {
                        item.style.display = 'flex';
                        item.style.opacity = '1';
                        hasResults = true;
                        resultCount++;
                        
                        // Highlight matching text
                        const nameElement = item.querySelector('.workspace-name');
                        if (nameElement && workspaceName.includes(searchTerm)) {
                            nameElement.innerHTML = workspaceName.replace(
                                new RegExp(searchTerm, 'gi'), 
                                match => `<mark style="background: #ffeb3b; padding: 1px 2px; border-radius: 2px; color: #333;">${match}</mark>`
                            );
                        }
                    } else {
                        item.style.display = 'none';
                    }
                });
                
                // Update section header with results count
                updateWorkspaceSectionHeader(resultCount, true);
                
                // Show no results message
                if (!hasResults && searchTerm !== '') {
                    showNoResultsMessage(searchTerm);
                } else {
                    removeNoResultsMessage();
                }
            });
            
            // Clear search on escape
            searchInput.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    searchInput.value = '';
                    searchInput.dispatchEvent(new Event('input'));
                    searchInput.blur();
                }
            });
            
            // Add search icon click functionality
            const searchIcon = document.querySelector('.search-icon');
            if (searchIcon) {
                searchIcon.addEventListener('click', () => {
                    searchInput.focus();
                });
            }
            
            console.log('Search functionality setup complete');
        }
        
        // Update workspace section header with results count
        function updateWorkspaceSectionHeader(count, isSearching) {
            const sectionHeader = document.querySelector('.component-section:nth-child(2) .section-header');
            if (sectionHeader) {
                if (isSearching) {
                    sectionHeader.innerHTML = `
                        <span class="section-icon">ðŸ¢</span>
                        Ù…Ø³Ø§Ø­Ø§Øª Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ù…ØªØ§Ø­Ø©
                        <span style="background: #5baa91; color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.8rem; margin-right: 8px;">
                            ${count} Ù†ØªÙŠØ¬Ø©
                        </span>
                    `;
                } else {
                    sectionHeader.innerHTML = `
                        <span class="section-icon">ðŸ¢</span>
                        Ù…Ø³Ø§Ø­Ø§Øª Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ù…ØªØ§Ø­Ø©
                    `;
                }
            }
        }
        
        // Show no results message
        function showNoResultsMessage(searchTerm) {
            removeNoResultsMessage(); // Remove any existing message
            
            const workspacesList = document.getElementById('workspacesList');
            const noResults = document.createElement('div');
            noResults.className = 'no-results';
            noResults.innerHTML = `
                <div class="no-results-icon">ðŸ”</div>
                <div style="font-weight: 600; margin-bottom: 8px;">Ù…Ø´ Ù„Ø§Ù‚ÙŠ Ø­Ø§Ø¬Ø©</div>
                <div>Ù…ÙÙŠØ´ Ù…Ø³Ø§Ø­Ø§Øª Ø¹Ù…Ù„ ØªØ·Ø§Ø¨Ù‚ "${searchTerm}"</div>
                <div style="font-size: 0.9rem; margin-top: 8px; opacity: 0.7;">Ø¬Ø±Ø¨ ÙƒÙ„Ù…Ø© ØªØ§Ù†ÙŠØ©</div>
            `;
            workspacesList.appendChild(noResults);
        }
        
        // Remove no results message
        function removeNoResultsMessage() {
            const existingNoResults = document.querySelector('.no-results');
            if (existingNoResults) {
                existingNoResults.remove();
            }
        }
        
        // Find and display nearest workspace
        function updateNearestWorkspace() {
            if (!userLocation) return;
            
            let nearestWorkspace = null;
            let nearestDistance = Infinity;
            
            workspaces.forEach(ws => {
                const distance = calculateDistance(userLocation[0], userLocation[1], ws.lat, ws.lng);
                if (distance < nearestDistance) {
                    nearestDistance = distance;
                    nearestWorkspace = ws;
                }
            });
            
            if (nearestWorkspace) {
                const nearestElement = document.getElementById('nearestWorkspace');
                nearestElement.style.display = 'block';
                
                // Update content with image
                nearestElement.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div style="width: 60px; height: 60px; border-radius: 10px; overflow: hidden; flex-shrink: 0; background: rgba(255,255,255,0.2); display: flex; align-items: center; justify-content: center;">
                            ${getWorkspaceImageUrl(nearestWorkspace) ? `
                                <img src="${getWorkspaceImageUrl(nearestWorkspace)}" alt="${nearestWorkspace.name}" style="width: 100%; height: 100%; object-fit: cover;" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                <div style="display: none; align-items: center; justify-content: center; width: 100%; height: 100%; color: white; font-size: 1.5rem;">ðŸ¢</div>
                            ` : `
                                <div style="display: flex; align-items: center; justify-content: center; width: 100%; height: 100%; color: white; font-size: 1.5rem;">ðŸ¢</div>
                            `}
                        </div>
                        <div style="flex: 1;">
                            <div class="nearest-title">ðŸ“ Ø£Ù‚Ø±Ø¨ Ù…Ø³Ø§Ø­Ø© Ø¹Ù…Ù„</div>
                            <div class="nearest-name">${nearestWorkspace.name}</div>
                            <div class="nearest-distance">${formatDistance(nearestDistance)}</div>
                        </div>
                    </div>
                `;
                
                // Add click to navigate
                nearestElement.style.cursor = 'pointer';
                nearestElement.onclick = () => {
                    // Remove previous selection
                    document.querySelectorAll('.workspace-item').forEach(item => {
                        item.classList.remove('selected');
                    });
                    
                    // Center map on nearest workspace
                    map.setView([nearestWorkspace.lat, nearestWorkspace.lng], 15);
                    
                    // Show workspace popup
                    nearestWorkspace.marker.openPopup();
                    
                    // If user location is available, show route
                    if (userLocation) {
                        showDirectionPanel(nearestWorkspace);
                    }
                };
            }
        }
        
        // Initialize workspace list and search
        populateWorkspaceList();
        setupSearch();
        
        // Set default route type
        document.querySelector('.route-btn').classList.add('active');
        
        // Make functions globally available
        window.showDirectionPanel = showDirectionPanel;
        window.showDirectionPanelById = showDirectionPanelById;
        window.closeDirectionPanel = closeDirectionPanel;
        window.toggleRouteType = toggleRouteType;
        window.getUserLocation = getUserLocation;
        window.toggleFabMenu = toggleFabMenu;
        window.clearRoute = clearRoute;
        window.fitToBounds = fitToBounds;
        window.toggleFullscreen = toggleFullscreen;
        window.toggleTrackingPanel = toggleTrackingPanel;
        window.startRealTimeTracking = startRealTimeTracking;
        window.pauseTracking = pauseTracking;
        window.resumeTracking = resumeTracking;
        window.stopTracking = stopTracking;
        window.closeNavigationPanel = closeNavigationPanel;
        window.toggleStatsPanel = toggleStatsPanel;
        
        // Toggle Stats Panel Function
        function toggleStatsPanel() {
            const statsCard = document.getElementById('statsCard');
            const statsToggle = document.getElementById('statsToggle');
            const fab = document.getElementById('fab');
            const fabMenu = document.getElementById('fabMenu');
            
            if (statsCard.classList.contains('collapsed')) {
                // Expand panel
                statsCard.classList.remove('collapsed');
                statsCard.classList.add('expanded');
                statsToggle.classList.remove('collapsed');
                statsToggle.classList.add('expanded');
                statsToggle.innerHTML = 'ðŸ“Š';
                statsToggle.title = 'Hide Quick Stats';
                
                // Move FAB over stats panel
                fab.classList.add('over-stats');
                fabMenu.classList.add('over-stats');
            } else {
                // Collapse panel
                statsCard.classList.remove('expanded');
                statsCard.classList.add('collapsed');
                statsToggle.classList.remove('expanded');
                statsToggle.classList.add('collapsed');
                statsToggle.innerHTML = 'ðŸ“Š';
                statsToggle.title = 'Show Quick Stats';
                
                // Move FAB back to bottom
                fab.classList.remove('over-stats');
                fabMenu.classList.remove('over-stats');
            }
        }
        
        // Initialize stats panel state
        document.addEventListener('DOMContentLoaded', function() {
            const statsCard = document.getElementById('statsCard');
            const statsToggle = document.getElementById('statsToggle');
            const fab = document.getElementById('fab');
            const fabMenu = document.getElementById('fabMenu');
            
            // Start with panel expanded on desktop, collapsed on mobile
            if (window.innerWidth <= 768) {
                statsCard.classList.add('collapsed');
                statsToggle.classList.add('collapsed');
                statsToggle.title = 'Show Quick Stats';
                
                // FAB stays at bottom on mobile initially
                fab.classList.remove('over-stats');
                fabMenu.classList.remove('over-stats');
            } else {
                statsCard.classList.add('expanded');
                statsToggle.classList.add('expanded');
                statsToggle.title = 'Hide Quick Stats';
                
                // FAB positioned over stats panel on desktop
                fab.classList.add('over-stats');
                fabMenu.classList.add('over-stats');
            }
        });
        
        // Handle window resize
        window.addEventListener('resize', function() {
            const statsCard = document.getElementById('statsCard');
            const statsToggle = document.getElementById('statsToggle');
            const fab = document.getElementById('fab');
            const fabMenu = document.getElementById('fabMenu');
            
            if (window.innerWidth <= 768) {
                // Mobile: ensure panel can be collapsed
                if (!statsCard.classList.contains('collapsed')) {
                    statsCard.classList.add('collapsed');
                    statsToggle.classList.add('collapsed');
                    statsToggle.title = 'Show Quick Stats';
                    
                    // Move FAB to bottom on mobile
                    fab.classList.remove('over-stats');
                    fabMenu.classList.remove('over-stats');
                }
            } else {
                // Desktop: ensure panel is expanded
                if (statsCard.classList.contains('collapsed')) {
                    statsCard.classList.remove('collapsed');
                    statsCard.classList.add('expanded');
                    statsToggle.classList.remove('collapsed');
                    statsToggle.classList.add('expanded');
                    statsToggle.title = 'Hide Quick Stats';
                    
                    // Move FAB over stats panel on desktop
                    fab.classList.add('over-stats');
                    fabMenu.classList.add('over-stats');
                }
            }
        });
        
        console.log('Map initialization complete!');
        
        // Cleanup function
        function cleanup() {
            if (locationWatchId) {
                navigator.geolocation.clearWatch(locationWatchId);
                locationWatchId = null;
            }
        }
        
        // Add cleanup on page unload
        window.addEventListener('beforeunload', cleanup);
        
        // Initialize map
        // initMap();
        
        // Show welcome message
        setTimeout(() => {
            showToast('Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù…Ø³Ø§Ø­Ø§Øª Ø§Ù„Ø¹Ù…Ù„ ÙÙŠ Ø£Ø³ÙŠÙˆØ·! ðŸŽ‰', 'success', 4000);
        }, 1000);
        
        // Add keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                // Close FAB menu
                const fabMenu = document.getElementById('fabMenu');
                if (fabMenu.classList.contains('active')) {
                    toggleFabMenu();
                }
                // Close direction panel
                const directionPanel = document.getElementById('directionPanel');
                if (directionPanel.classList.contains('show')) {
                    closeDirectionPanel();
                }
                // Close tracking panel
                const trackingPanel = document.getElementById('trackingPanel');
                if (trackingPanel.classList.contains('show')) {
                    stopTracking();
                }
            }
            if (e.key === 'l' || e.key === 'L') {
                getUserLocation();
            }
            if (e.key === 'f' || e.key === 'F') {
                fitToBounds();
            }
            if (e.key === 's' || e.key === 'S') {
                toggleStatsPanel();
            }
            if (e.key === 't' || e.key === 'T') {
                toggleTrackingPanel();
            }
            if (e.key === 'c' || e.key === 'C') {
                clearRoute();
            }
        });
        
        // Add touch/swipe gestures for mobile
        let touchStartY = 0;
        let touchEndY = 0;
        
        document.addEventListener('touchstart', function(e) {
            touchStartY = e.changedTouches[0].screenY;
        });
        
        document.addEventListener('touchend', function(e) {
            touchEndY = e.changedTouches[0].screenY;
            handleSwipe();
        });
        
        function handleSwipe() {
            const swipeThreshold = 50;
            const swipeDistance = touchEndY - touchStartY;
            
            // Swipe up to show stats panel on mobile
            if (swipeDistance < -swipeThreshold && window.innerWidth <= 768) {
                const statsCard = document.getElementById('statsCard');
                if (statsCard.classList.contains('collapsed')) {
                    toggleStatsPanel();
                }
            }
            
            // Swipe down to hide stats panel on mobile
            if (swipeDistance > swipeThreshold && window.innerWidth <= 768) {
                const statsCard = document.getElementById('statsCard');
                if (!statsCard.classList.contains('collapsed')) {
                    toggleStatsPanel();
                }
            }
        }
        
        // Add haptic feedback for mobile devices
        function hapticFeedback() {
            if ('vibrate' in navigator) {
                navigator.vibrate(50);
            }
        }
        
        // Enhanced button interactions
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('quick-action-btn') || 
                e.target.classList.contains('route-btn') || 
                e.target.classList.contains('fab-item') ||
                e.target.classList.contains('workspace-item')) {
                hapticFeedback();
            }
        });
        
        // Add loading states and better feedback
        function showLoadingState(element, text = 'Loading...') {
            const originalText = element.textContent;
            element.textContent = text;
            element.disabled = true;
            element.style.opacity = '0.7';
            
            return function() {
                element.textContent = originalText;
                element.disabled = false;
                element.style.opacity = '1';
            };
        }
        
        // Enhanced getUserLocation with loading state
        const originalGetUserLocation = getUserLocation;
        getUserLocation = function() {
            const button = document.getElementById('getLocation');
            const resetLoading = showLoadingState(button, 'â³ Locating...');
            
            originalGetUserLocation();
            
            // Reset loading state after 15 seconds (timeout)
            setTimeout(resetLoading, 15000);
        };
        
        // Add smooth scrolling to workspace list
        function scrollToWorkspace(workspaceId) {
            const workspaceItems = document.querySelectorAll('.workspace-item');
            const targetItem = workspaceItems[workspaceId - 1];
            
            if (targetItem) {
                targetItem.scrollIntoView({
                    behavior: 'smooth',
                    block: 'center'
                });
                
                // Add highlight effect
                targetItem.style.background = 'linear-gradient(135deg, #5baa91 0%, #4a8c7a 100%)';
                targetItem.style.color = 'white';
                targetItem.style.transform = 'scale(1.05)';
                
                setTimeout(() => {
                    targetItem.style.background = '';
                    targetItem.style.color = '';
                    targetItem.style.transform = '';
                }, 2000);
            }
        }
        
        // Enhanced workspace click with scroll
        function enhancedWorkspaceClick(workspace) {
            // Scroll to workspace in list
            scrollToWorkspace(workspace.id);
            
            // Center map with animation
            map.setView([workspace.lat, workspace.lng], 15, {
                animate: true,
                duration: 1
            });
            
            // Show popup with delay for better UX
            setTimeout(() => {
                workspace.marker.openPopup();
            }, 500);
            
            // If user location is available, show route
            if (userLocation) {
                setTimeout(() => {
                    showDirectionPanel(workspace);
                }, 800);
            }
        }
        
        // UX Enhancement Functions
        
        // FAB Menu Toggle
        function toggleFabMenu() {
            const fabMenu = document.getElementById('fabMenu');
            const fabIcon = document.getElementById('fabIcon');
            
            if (fabMenu.classList.contains('active')) {
                fabMenu.classList.remove('active');
                fabIcon.textContent = '+';
            } else {
                fabMenu.classList.add('active');
                fabIcon.textContent = 'Ã—';
            }
        }
        
        // Toast Notification System
        function showToast(message, type = 'info', duration = 3000) {
            const toastContainer = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span>${getToastIcon(type)}</span>
                    <span>${message}</span>
                </div>
            `;
            
            toastContainer.appendChild(toast);
            
            // Show toast
            setTimeout(() => toast.classList.add('show'), 100);
            
            // Hide and remove toast
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 300);
            }, duration);
        }
        
        function getToastIcon(type) {
            switch(type) {
                case 'success': return 'âœ…';
                case 'error': return 'âŒ';
                case 'warning': return 'âš ï¸';
                default: return 'â„¹ï¸';
            }
        }
        
        // Progress Bar
        function showProgress(progress) {
            const progressBar = document.getElementById('progressBar');
            progressBar.style.width = `${progress}%`;
        }
        
        function hideProgress() {
            const progressBar = document.getElementById('progressBar');
            progressBar.style.width = '0%';
        }
        
        // Clear Route Function
        function clearRoute() {
            if (routePolyline) {
                map.removeLayer(routePolyline);
                routePolyline = null;
            }
            routeMarkers.forEach(marker => map.removeLayer(marker));
            routeMarkers = [];
            
            const directionInfo = document.getElementById('directionInfo');
            directionInfo.innerHTML = '<div style="text-align: center; padding: 20px; color: #666;">Click on a workspace to get directions</div>';
            
            showToast('Route cleared', 'success');
            toggleFabMenu();
        }
        
        // Fit to Bounds Function
        function fitToBounds() {
            if (userLocation && workspaces.length > 0) {
                const bounds = L.latLngBounds([userLocation]);
                workspaces.forEach(ws => {
                    bounds.extend([ws.lat, ws.lng]);
                });
                map.fitBounds(bounds, { padding: [20, 20] });
                showToast('Map fitted to all locations', 'success');
            } else if (workspaces.length > 0) {
                const bounds = L.latLngBounds();
                workspaces.forEach(ws => {
                    bounds.extend([ws.lat, ws.lng]);
                });
                map.fitBounds(bounds, { padding: [20, 20] });
                showToast('Map fitted to workspaces', 'success');
            } else {
                showToast('No locations to fit', 'warning');
            }
            toggleFabMenu();
        }
        
        // Fullscreen Toggle
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().then(() => {
                    showToast('Entered fullscreen mode', 'success');
                }).catch(err => {
                    showToast('Fullscreen not supported', 'error');
                });
            } else {
                document.exitFullscreen().then(() => {
                    showToast('Exited fullscreen mode', 'success');
                });
            }
            toggleFabMenu();
        }
        
        // Enhanced Click Handlers
        function addWorkspaceClickHandler(workspace, marker) {
            marker.on('click', function() {
                // Add pulse effect to clicked marker
                const markerElement = marker.getElement();
                if (markerElement) {
                    markerElement.classList.add('pulse');
                    setTimeout(() => {
                        markerElement.classList.remove('pulse');
                    }, 2000);
                }
                
                if (userLocation) {
                    showProgress(50);
                    createRoute(userLocation, [workspace.lat, workspace.lng]);
                    showProgress(100);
                    setTimeout(hideProgress, 500);
                    showToast(`Route to ${workspace.name} created`, 'success');
                } else {
                    showToast('Please get your location first', 'warning');
                }
            });
        }
        
        // Real-time Tracking Functions
        
        // Toggle tracking panel
        function toggleTrackingPanel() {
            const trackingPanel = document.getElementById('trackingPanel');
            if (trackingPanel.classList.contains('show')) {
                trackingPanel.classList.remove('show');
                toggleFabMenu();
            } else {
                trackingPanel.classList.add('show');
                toggleFabMenu();
            }
        }
        
        // Start real-time tracking
        function startRealTimeTracking() {
            if (!userLocation || !selectedWorkspace) {
                showToast('Please get your location and select a destination first', 'warning');
                return;
            }
            
            isTracking = true;
            trackingPath = [userLocation];
            currentRouteIndex = 0;
            
            // Update UI
            document.getElementById('startTrackingBtn').style.display = 'none';
            document.getElementById('pauseBtn').style.display = 'block';
            document.getElementById('resumeBtn').style.display = 'none';
            document.getElementById('statusDot').className = 'status-dot tracking';
            document.getElementById('statusText').textContent = 'Live tracking active';
            
            // Create tracking polyline
            if (trackingPolyline) {
                map.removeLayer(trackingPolyline);
            }
            trackingPolyline = L.polyline(trackingPath, {
                color: '#dc3545',
                weight: 4,
                opacity: 0.8,
                dashArray: '10, 5'
            }).addTo(map);
            
            // Update user marker for tracking
            if (userMarker) {
                map.removeLayer(userMarker);
            }
            userMarker = L.marker(userLocation, { 
                icon: L.divIcon({
                    html: `<div style="background: #dc3545; width: 20px; height: 20px; border-radius: 50%; border: 3px solid white; box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.3);"></div>`,
                    className: 'realtime-marker',
                    iconSize: [20, 20],
                    iconAnchor: [10, 10]
                })
            }).addTo(map);
            
            // Start high-frequency location updates
            startHighFrequencyTracking();
            
            // Generate route instructions
            generateRouteInstructions();
            
            showToast('Live navigation started!', 'success');
        }
        
        // Start high-frequency location tracking
        function startHighFrequencyTracking() {
            if (locationWatchId) {
                navigator.geolocation.clearWatch(locationWatchId);
            }
            
            const options = {
                enableHighAccuracy: true,
                timeout: 5000,
                maximumAge: 0
            };
            
            locationWatchId = navigator.geolocation.watchPosition(
                function(position) {
                    updateRealTimeLocation(position);
                },
                function(error) {
                    console.warn('High-frequency tracking error:', error);
                    document.getElementById('statusDot').className = 'status-dot error';
                    document.getElementById('statusText').textContent = 'Tracking error';
                },
                options
            );
        }
        
        // Update real-time location
        function updateRealTimeLocation(position) {
            const newLocation = [position.coords.latitude, position.coords.longitude];
            const accuracy = position.coords.accuracy;
            const speed = position.coords.speed || 0;
            
            // Update user location
            userLocation = newLocation;
            
            // Add to tracking path
            trackingPath.push(newLocation);
            
            // Update tracking polyline
            if (trackingPolyline) {
                trackingPolyline.setLatLngs(trackingPath);
            }
            
            // Update user marker
            if (userMarker) {
                userMarker.setLatLng(newLocation);
            }
            
            // Update tracking info
            updateTrackingInfo(newLocation, accuracy, speed);
            
            // Check if we're near the destination
            checkDestinationProximity(newLocation);
            
            // Update navigation instructions
            updateNavigationInstructions(newLocation);
            
            // Keep map centered on user
            map.setView(newLocation, map.getZoom());
        }
        
        // Update tracking information
        function updateTrackingInfo(currentLocation, accuracy, speed) {
            if (selectedWorkspace) {
                const remainingDistance = calculateDistance(
                    currentLocation[0], currentLocation[1],
                    selectedWorkspace.lat, selectedWorkspace.lng
                );
                
                // Use GPS speed if available, otherwise use route type speed
                let estimatedSpeed = speed * 3.6; // Convert m/s to km/h
                if (estimatedSpeed <= 0 || !speed) {
                    // Use route type speed as fallback
                    const speeds = {
                        driving: 30,
                        walking: 5,
                        cycling: 15,
                        motorcycle: 25
                    };
                    estimatedSpeed = speeds[currentRouteType] || speeds.driving;
                }
                
                const eta = remainingDistance / estimatedSpeed * 60;
                
                document.getElementById('remainingDistance').textContent = formatDistance(remainingDistance);
                document.getElementById('eta').textContent = eta > 0 ? formatTravelTime(eta) : '-';
                document.getElementById('currentSpeed').textContent = `${Math.round(estimatedSpeed)} km/h`;
                document.getElementById('trackingAccuracy').textContent = `Â±${Math.round(accuracy)}m`;
            }
        }
        
        // Check destination proximity
        function checkDestinationProximity(currentLocation) {
            if (selectedWorkspace) {
                const distance = calculateDistance(
                    currentLocation[0], currentLocation[1],
                    selectedWorkspace.lat, selectedWorkspace.lng
                );
                
                if (distance < 0.05) { // Within 50 meters
                    showToast('ðŸŽ‰ You have arrived at your destination!', 'success');
                    stopTracking();
                }
            }
        }
        
        // Generate route instructions
        function generateRouteInstructions() {
            if (!routePolyline || !selectedWorkspace) return;
            
            const routeCoords = routePolyline.getLatLngs();
            routeInstructions = [];
            
            for (let i = 0; i < routeCoords.length - 1; i++) {
                const current = routeCoords[i];
                const next = routeCoords[i + 1];
                const bearing = getBearing(current.lat, current.lng, next.lat, next.lng);
                const distance = calculateDistance(current.lat, current.lng, next.lat, next.lng);
                
                if (distance > 0.1) { // Only add significant turns
                    routeInstructions.push({
                        lat: current.lat,
                        lng: current.lng,
                        bearing: bearing,
                        distance: distance,
                        instruction: getTurnInstruction(bearing)
                    });
                }
            }
        }
        
        // Get turn instruction
        function getTurnInstruction(bearing) {
            const directions = ['North', 'Northeast', 'East', 'Southeast', 'South', 'Southwest', 'West', 'Northwest'];
            const index = Math.round(bearing / 45) % 8;
            return `Continue ${directions[index]}`;
        }
        
        // Update navigation instructions
        function updateNavigationInstructions(currentLocation) {
            if (routeInstructions.length === 0) return;
            
            // Find nearest instruction point
            let nearestInstruction = null;
            let minDistance = Infinity;
            
            routeInstructions.forEach((instruction, index) => {
                const distance = calculateDistance(
                    currentLocation[0], currentLocation[1],
                    instruction.lat, instruction.lng
                );
                
                if (distance < minDistance && distance < 0.1) { // Within 100 meters
                    minDistance = distance;
                    nearestInstruction = { ...instruction, index };
                }
            });
            
            if (nearestInstruction) {
                const instructionCard = document.getElementById('currentInstruction');
                const icon = getDirectionIcon(nearestInstruction.bearing);
                
                instructionCard.innerHTML = `
                    <div class="instruction-icon">${icon}</div>
                    <div class="instruction-text">${nearestInstruction.instruction}</div>
                `;
                
                // Remove this instruction from the list
                routeInstructions.splice(nearestInstruction.index, 1);
            }
        }
        
        // Get direction icon
        function getDirectionIcon(bearing) {
            const normalizedBearing = (bearing + 360) % 360;
            
            if (normalizedBearing >= 315 || normalizedBearing < 45) return 'â¬†ï¸';
            if (normalizedBearing >= 45 && normalizedBearing < 135) return 'âž¡ï¸';
            if (normalizedBearing >= 135 && normalizedBearing < 225) return 'â¬‡ï¸';
            if (normalizedBearing >= 225 && normalizedBearing < 315) return 'â¬…ï¸';
            
            return 'ðŸš¶';
        }
        
        // Pause tracking
        function pauseTracking() {
            isTracking = false;
            document.getElementById('pauseBtn').style.display = 'none';
            document.getElementById('resumeBtn').style.display = 'block';
            document.getElementById('statusDot').className = 'status-dot paused';
            document.getElementById('statusText').textContent = 'Tracking paused';
            showToast('Navigation paused', 'warning');
        }
        
        // Resume tracking
        function resumeTracking() {
            isTracking = true;
            document.getElementById('pauseBtn').style.display = 'block';
            document.getElementById('resumeBtn').style.display = 'none';
            document.getElementById('statusDot').className = 'status-dot tracking';
            document.getElementById('statusText').textContent = 'Live tracking active';
            showToast('Navigation resumed', 'success');
        }
        
        // Stop tracking
        function stopTracking() {
            isTracking = false;
            
            // Reset UI - check if elements exist before accessing
            const startTrackingBtn = document.getElementById('startTrackingBtn');
            const pauseBtn = document.getElementById('pauseBtn');
            const resumeBtn = document.getElementById('resumeBtn');
            const statusDot = document.getElementById('statusDot');
            const statusText = document.getElementById('statusText');
            const remainingDistance = document.getElementById('remainingDistance');
            const eta = document.getElementById('eta');
            const currentSpeed = document.getElementById('currentSpeed');
            const trackingAccuracy = document.getElementById('trackingAccuracy');
            const currentInstruction = document.getElementById('currentInstruction');
            const trackingPanel = document.getElementById('trackingPanel');
            
            // Only update UI elements if they exist
            if (startTrackingBtn) startTrackingBtn.style.display = 'block';
            if (pauseBtn) pauseBtn.style.display = 'none';
            if (resumeBtn) resumeBtn.style.display = 'none';
            if (statusDot) statusDot.className = 'status-dot';
            if (statusText) statusText.textContent = 'Ready to track';
            
            // Reset tracking info
            if (remainingDistance) remainingDistance.textContent = '-';
            if (eta) eta.textContent = '-';
            if (currentSpeed) currentSpeed.textContent = '-';
            if (trackingAccuracy) trackingAccuracy.textContent = '-';
            
            // Reset instruction
            if (currentInstruction) {
                currentInstruction.innerHTML = `
                    <div class="instruction-icon">ðŸš¶</div>
                    <div class="instruction-text">Start navigation to begin</div>
                `;
            }
            
            // Remove tracking polyline
            if (trackingPolyline) {
                map.removeLayer(trackingPolyline);
                trackingPolyline = null;
            }
            
            // Reset user marker only if userLocation exists
            if (userLocation && userMarker) {
                map.removeLayer(userMarker);
                userMarker = L.marker(userLocation, { icon: userLocationIcon }).addTo(map);
            }
            
            // Hide tracking panel
            if (trackingPanel) {
                trackingPanel.classList.remove('show');
            }
            
            // Restart normal location tracking
            startLocationTracking();
            
            showToast('Navigation stopped', 'info');
        }

        // Close navigation panel function
        function closeNavigationPanel() {
            const trackingPanel = document.getElementById('trackingPanel');
            if (trackingPanel) {
                trackingPanel.classList.remove('show');
            }
            
            // If tracking is active, stop it
            if (isTracking) {
                stopTracking();
            }
            
            showToast('Navigation panel closed', 'info');
        }

        // Alternative street routing with MapBox
        function createStreetRoute(start, end) {
            // MapBox Directions API (free tier)
            const apiUrl = `https://api.mapbox.com/directions/v5/mapbox/driving/${start[1]},${start[0]};${end[1]},${end[0]}?geometries=geojson&access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw`;
            
            fetch(apiUrl)
            .then(response => {
                if (!response.ok) {
                    throw new Error('MapBox API failed');
                }
                return response.json();
            })
            .then(data => {
                if (data.routes && data.routes.length > 0) {
                    const route = data.routes[0];
                    const coordinates = route.geometry.coordinates.map(coord => [coord[1], coord[0]]);
                    
                    // Create street-level polyline
                    routePolyline = L.polyline(coordinates, {
                        color: '#5baa91',
                        weight: 6,
                        opacity: 0.8,
                        dashArray: '20, 10',
                        lineCap: 'round',
                        lineJoin: 'round'
                    }).addTo(map);
                    
                    // Removed multiple arrows for cleaner design
                    // Only route line is shown now
                    
                    // Fit map to show entire route
                    const bounds = L.latLngBounds(coordinates);
                    map.fitBounds(bounds, { padding: [20, 20] });
                    
                    // Update with street route info
                    const distance = route.distance / 1000;
                    const duration = route.duration / 60;
                    
                    const directionInfo = document.getElementById('directionInfo');
                    directionInfo.innerHTML = `
                        <div class="direction-item">
                            <span class="direction-label">Street Route Distance:</span>
                            <span class="direction-value">${formatDistance(distance)}</span>
                        </div>
                        <div class="direction-item">
                            <span class="direction-label">Estimated Time:</span>
                            <span class="direction-value">${Math.round(duration)} min</span>
                        </div>
                        <div class="direction-item">
                            <span class="direction-label">Route Type:</span>
                            <span class="direction-value">Street Navigation</span>
                        </div>
                        <div class="direction-item">
                            <span class="direction-label">Coordinates:</span>
                            <span class="direction-value">${end[0].toFixed(4)}, ${end[1].toFixed(4)}</span>
                        </div>
                    `;
                    
                    showProgress(100);
                    setTimeout(hideProgress, 500);
                    showToast('Street route calculated successfully!', 'success');
                }
            })
            .catch(error => {
                console.error('MapBox routing error:', error);
                // Fall back to OSRM
                createRoute(start, end);
            });
        }

        // Route type selection
        let currentRouteType = 'driving';
        
        function toggleRouteType(type) {
            console.log('Route type changed to:', type);
            currentRouteType = type;
            
            // Update button states
            document.querySelectorAll('.route-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // If there's a current route, recalculate with new type
            if (selectedWorkspace && userLocation) {
                console.log('Recalculating route with new type:', type);
                createRoute(userLocation, [selectedWorkspace.lat, selectedWorkspace.lng], type);
            }
            
            showToast(`${type.charAt(0).toUpperCase() + type.slice(1)} route selected`, 'success');
        }
        
        // Initialize workspace list and search
        populateWorkspaceList();
        setupSearch();
        
        // Set default route type
        document.querySelector('.route-btn').classList.add('active');
        
        // Enhanced workspace click with scroll
        function enhancedWorkspaceClick(workspace) {
            // Scroll to workspace in list
            scrollToWorkspace(workspace.id);
            
            // Center map with animation
            map.setView([workspace.lat, workspace.lng], 15, {
                animate: true,
                duration: 1
            });
            
            // Show popup with delay for better UX
            setTimeout(() => {
                workspace.marker.openPopup();
            }, 500);
            
            // If user location is available, show route
            if (userLocation) {
                setTimeout(() => {
                    showDirectionPanel(workspace);
                }, 800);
            }
        }
        
        // Help Tooltip System
        function showTooltip(element, message, duration = 3000) {
            const tooltip = document.getElementById('helpTooltip');
            const rect = element.getBoundingClientRect();
            
            tooltip.textContent = message;
            tooltip.style.left = rect.left + (rect.width / 2) - (tooltip.offsetWidth / 2) + 'px';
            tooltip.style.top = rect.top - 50 + 'px';
            tooltip.classList.add('show');
            
            setTimeout(() => {
                tooltip.classList.remove('show');
            }, duration);
        }
        
        // Loading Overlay Functions
        function showLoadingOverlay(message = 'Loading...') {
            const overlay = document.getElementById('loadingOverlay');
            overlay.classList.add('show');
        }
        
        function hideLoadingOverlay() {
            const overlay = document.getElementById('loadingOverlay');
            overlay.classList.remove('show');
        }
        
        // Welcome Tour Functions
        function showWelcomeTour() {
            const tour = document.getElementById('welcomeTour');
            tour.classList.add('show');
        }
        
        function hideWelcomeTour() {
            const tour = document.getElementById('welcomeTour');
            tour.classList.remove('show');
            localStorage.setItem('tourShown', 'true');
        }
        
        function skipTour() {
            hideWelcomeTour();
        }
        
        function startTour() {
            hideWelcomeTour();
            setTimeout(() => {
                showTooltip(document.getElementById('statsToggle'), 'Ø§Ù†Ù‚Ø± Ù‡Ù†Ø§ Ù„Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø³Ø±ÙŠØ¹Ø©', 4000);
                setTimeout(() => {
                    showTooltip(document.getElementById('getLocation'), 'Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ù„Ø§Ø­Ø©', 4000);
                }, 5000);
            }, 1000);
        }
        
        // Enhanced error handling with user feedback
        function handleError(error, context = '') {
            console.error(`Error in ${context}:`, error);
            
            let userMessage = 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ù…Ø§. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.';
            
            if (error.message.includes('timeout')) {
                userMessage = 'Ø§Ù†ØªÙ‡Øª Ù…Ù‡Ù„Ø© Ø§Ù„Ø·Ù„Ø¨. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„Ùƒ.';
            } else if (error.message.includes('permission')) {
                userMessage = 'ØªÙ… Ø±ÙØ¶ Ø¥Ø°Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹. ÙŠØ±Ø¬Ù‰ ØªÙ…ÙƒÙŠÙ† Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…ÙˆÙ‚Ø¹.';
            } else if (error.message.includes('unavailable')) {
                userMessage = 'Ø®Ø¯Ù…Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØºÙŠØ± Ù…ØªØ§Ø­Ø©. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹.';
            }
            
            showToast(userMessage, 'error');
            
            // Add visual feedback
            const mapElement = document.getElementById('map');
            mapElement.classList.add('shake');
            setTimeout(() => {
                mapElement.classList.remove('shake');
            }, 500);
        }
        
        // Enhanced success feedback
        function showSuccessFeedback(element) {
            element.classList.add('pulse-highlight');
            setTimeout(() => {
                element.classList.remove('pulse-highlight');
            }, 600);
        }
        
        // Auto-hide panels on mobile when map is interacted with
        map.on('click', function() {
            if (window.innerWidth <= 768) {
                const statsCard = document.getElementById('statsCard');
                if (!statsCard.classList.contains('collapsed')) {
                    toggleStatsPanel();
                }
            }
        });
        
        // Enhanced workspace list population with better UX
        function populateWorkspaceList() {
            const workspacesList = document.getElementById('workspacesList');
            if (!workspacesList) {
                console.error('Workspaces list container not found!');
                return;
            }
            
            console.log('Populating workspace list with', workspaces.length, 'workspaces');
            
            workspacesList.innerHTML = '';
            
            workspaces.forEach((ws, index) => {
                const workspaceItem = document.createElement('div');
                workspaceItem.className = 'workspace-item';
                workspaceItem.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 12px; flex: 1;">
                        <div style="width: 50px; height: 50px; border-radius: 8px; overflow: hidden; flex-shrink: 0; background: #f8f9fa; display: flex; align-items: center; justify-content: center;">
                            ${getWorkspaceImageUrl(ws) ? `
                                <img src="${getWorkspaceImageUrl(ws)}" alt="${ws.name}" style="width: 100%; height: 100%; object-fit: cover;" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                <div style="display: none; align-items: center; justify-content: center; width: 100%; height: 100%; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); color: #666; font-size: 1.2rem;">ðŸ¢</div>
                            ` : `
                                <div style="display: flex; align-items: center; justify-content: center; width: 100%; height: 100%; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); color: #666; font-size: 1.2rem;">ðŸ¢</div>
                            `}
                        </div>
                        <div style="flex: 1; min-width: 0;">
                            <div class="workspace-name" style="margin-bottom: 4px;">${ws.name}</div>
                            <div style="font-size: 0.8rem; color: #666; line-height: 1.3;">${ws.description.substring(0, 60)}${ws.description.length > 60 ? '...' : ''}</div>
                        </div>
                    </div>
                    <span class="workspace-badge">${ws.badge}</span>
                `;
                
                workspaceItem.addEventListener('click', () => {
                    console.log('Workspace clicked:', ws.name);
                    
                    // Add haptic feedback
                    hapticFeedback();
                    
                    // Remove previous selection
                    document.querySelectorAll('.workspace-item').forEach(item => {
                        item.classList.remove('selected');
                    });
                    
                    // Add selection to current item
                    workspaceItem.classList.add('selected');
                    
                    // Use enhanced click function
                    enhancedWorkspaceClick(ws);
                    
                    // Show success feedback
                    showSuccessFeedback(workspaceItem);
                });
                
                // Add hover tooltip
                workspaceItem.addEventListener('mouseenter', () => {
                    if (window.innerWidth > 768) {
                        showTooltip(workspaceItem, `Ø§Ù†Ù‚Ø± Ù„Ø¹Ø±Ø¶ ${ws.name}`, 2000);
                    }
                });
                
                workspacesList.appendChild(workspaceItem);
            });
            
            console.log('Workspace list populated successfully');
        }
        
        // Initialize welcome tour on first visit
        document.addEventListener('DOMContentLoaded', function() {
            const tourShown = localStorage.getItem('tourShown');
            if (!tourShown) {
                setTimeout(() => {
                    showWelcomeTour();
                }, 2000);
            }
            
            // Preload workspace images for better performance
            setTimeout(() => {
                preloadWorkspaceImages();
            }, 1000);
        });
        
        // Update toast messages to Arabic
        function showToast(message, type = 'info', duration = 3000) {
            const toastContainer = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span>${getToastIcon(type)}</span>
                    <span>${message}</span>
                </div>
            `;
            
            toastContainer.appendChild(toast);
            
            // Show toast
            setTimeout(() => toast.classList.add('show'), 100);
            
            // Hide and remove toast
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 300);
            }, duration);
        }
        
        // Update tooltip messages to Arabic
        function startTour() {
            hideWelcomeTour();
            setTimeout(() => {
                showTooltip(document.getElementById('statsToggle'), 'Ø§Ù†Ù‚Ø± Ù‡Ù†Ø§ Ù„Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø³Ø±ÙŠØ¹Ø©', 4000);
                setTimeout(() => {
                    showTooltip(document.getElementById('getLocation'), 'Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ù„Ø§Ø­Ø©', 4000);
                }, 5000);
            }, 1000);
        }
        
        // Preload workspace images for better performance
        function preloadWorkspaceImages() {
            workspaces.forEach(ws => {
                const imageUrl = getWorkspaceImageUrl(ws);
                if (imageUrl) {
                    const img = new Image();
                    img.src = imageUrl;
                    // Store the preloaded image for potential reuse
                    ws.preloadedImage = img;
                    
                    // Refresh marker when image loads
                    img.onload = function() {
                        if (ws.marker) {
                            // Update the marker icon with the loaded image
                            ws.marker.setIcon(createWorkspaceIcon(ws));
                        }
                    };
                }
            });
        }
    </script>
</body>
</html> 
